"use strict";(()=>{var e={};e.id=4070,e.ids=[4070],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},6005:e=>{e.exports=require("node:crypto")},57173:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>b,patchFetch:()=>h,requestAsyncStorage:()=>v,routeModule:()=>I,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f});var s={};i.r(s),i.d(s,{GET:()=>x,PATCH:()=>y,POST:()=>q});var r=i(49303),n=i(88716),a=i(60670),o=i(87070),u=i(88879),d=i(9487),l=i(31402),p=i(90455),c=i(14749),g=i(66907),m=i(63261);async function x(e){try{let t=await (0,p.mk)(e);(0,p.Ql)(t,"listings:read");let{searchParams:i}=new URL(e.url),s={type:i.get("type")||void 0,status:i.get("status")||void 0,city:i.get("city")||void 0,q:i.get("q")||void 0,page:parseInt(i.get("page")||"1"),limit:parseInt(i.get("limit")||"20")},r={businessId:t.businessId};s.type&&(r.type=s.type),s.status&&(r.status=s.status),s.city&&(r.locationCity={contains:s.city,mode:"insensitive"}),s.q&&(r.OR=[{title:{contains:s.q,mode:"insensitive"}},{description:{contains:s.q,mode:"insensitive"}},{slug:{contains:s.q,mode:"insensitive"}},{category:{contains:s.q,mode:"insensitive"}}]);let[n,a]=await Promise.all([d.db.listing.findMany({where:r,orderBy:{createdAt:"desc"},skip:(s.page-1)*s.limit,take:s.limit,include:{_count:{select:{orders:!0,reviews:!0}}}}),d.db.listing.count({where:r})]);return(0,l.ok)({listings:n,pagination:{page:s.page,limit:s.limit,total:a,pages:Math.ceil(a/s.limit)}})}catch(e){if(e instanceof u.jmq)return(0,l.lI)("Invalid filters",e.errors);return(0,l.Vm)("Failed to fetch listings",e)}}async function q(e){try{let t=await (0,p.mk)(e);(0,p.Ql)(t,"listings:create");let i=await e.json(),s=m.gl.parse(i);s.details&&s.details.kind!==s.type&&(s.details.kind=s.type);let r=await d.db.listing.create({data:{...s,businessId:t.businessId,status:s.status||"DRAFT"},include:{_count:{select:{orders:!0,reviews:!0}}}});return await (0,c.ar)(t.id,"user",c.sZ.LISTING_CREATED,"listing",r.id,t.businessId,{title:r.title,type:r.type}),await (0,g.DR)(g.yd.LISTING_CREATED,r,t.businessId),o.NextResponse.json(r,{status:201})}catch(e){if(e instanceof u.jmq)return(0,l.lI)("Invalid listing data",e.errors);return(0,l.Vm)("Failed to create listing",e)}}async function y(e){try{let t=await (0,p.mk)(e);(0,p.Ql)(t,"listings:update");let{searchParams:i}=new URL(e.url),s=i.get("id");if(!s)return(0,l.lI)("Listing ID is required");let r=await e.json(),n=m.z9.parse(r);if(!await d.db.listing.findFirst({where:{id:s,businessId:t.businessId}}))return o.NextResponse.json({error:"Listing not found"},{status:404});let a=await d.db.listing.update({where:{id:s},data:{...n,updatedAt:new Date},include:{_count:{select:{orders:!0,reviews:!0}}}});return await (0,c.ar)(t.id,"user",c.sZ.LISTING_UPDATED,"listing",a.id,t.businessId,{title:a.title,type:a.type,changes:Object.keys(n)}),await (0,g.DR)(g.yd.LISTING_UPDATED,a,t.businessId),(0,l.ok)(a)}catch(e){if(e instanceof u.jmq)return(0,l.lI)("Invalid listing data",e.errors);return(0,l.Vm)("Failed to update listing",e)}}let I=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/listings/route",pathname:"/api/listings",filename:"route",bundlePath:"app/api/listings/route"},resolvedPagePath:"/Users/kumar/Business admin/tripfluence-admin/app/api/listings/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:f,serverHooks:w}=I,b="/api/listings/route";function h(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[8948,147,5972,6608,1909,5344],()=>i(57173));module.exports=s})();