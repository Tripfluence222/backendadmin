"use strict";(()=>{var e={};e.id=2757,e.ids=[2757],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},6005:e=>{e.exports=require("node:crypto")},98225:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>b,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var i={};r.r(i),r.d(i,{DELETE:()=>w,GET:()=>g,PATCH:()=>q});var s=r(49303),n=r(88716),a=r(60670),o=r(88879),u=r(9487),d=r(31402),l=r(90455),p=r(14749),c=r(66907),x=r(63261);async function g(e,{params:t}){try{let r=await (0,l.mk)(e);(0,l.Ql)(r,"listings:read");let{id:i}=await t,s=await u.db.listing.findFirst({where:{id:i,businessId:r.businessId},include:{_count:{select:{orders:!0,reviews:!0}}}});if(!s)return(0,d.v6)("Listing not found");return(0,d.ok)(s)}catch(e){return(0,d.Vm)("Failed to fetch listing",e)}}async function q(e,{params:t}){try{let r=await (0,l.mk)(e);(0,l.Ql)(r,"listings:update");let{id:i}=await t,s=await e.json(),n=x.z9.parse(s);if(!await u.db.listing.findFirst({where:{id:i,businessId:r.businessId}}))return(0,d.v6)("Listing not found");n.details&&n.type&&n.details.kind!==n.type&&(n.details.kind=n.type);let a=await u.db.listing.update({where:{id:i},data:{...n,updatedAt:new Date},include:{_count:{select:{orders:!0,reviews:!0}}}});return await (0,p.ar)(r.id,"user",p.sZ.LISTING_UPDATED,"listing",a.id,r.businessId,{title:a.title,type:a.type,changes:Object.keys(n)}),await (0,c.DR)(c.yd.LISTING_UPDATED,a,r.businessId),(0,d.ok)(a)}catch(e){if(e instanceof o.jmq)return(0,d.lI)("Invalid listing data",e.errors);return(0,d.Vm)("Failed to update listing",e)}}async function w(e,{params:t}){try{let r=await (0,l.mk)(e);(0,l.Ql)(r,"listings:delete");let{id:i}=await t,s=await u.db.listing.findFirst({where:{id:i,businessId:r.businessId}});if(!s)return(0,d.v6)("Listing not found");return await u.db.listing.delete({where:{id:i}}),await (0,p.ar)(r.id,"user",p.sZ.LISTING_DELETED,"listing",i,r.businessId,{title:s.title,type:s.type}),await (0,c.DR)(c.yd.LISTING_DELETED,{id:i,...s},r.businessId),(0,d.ok)({success:!0})}catch(e){return(0,d.Vm)("Failed to delete listing",e)}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/listings/[id]/route",pathname:"/api/listings/[id]",filename:"route",bundlePath:"app/api/listings/[id]/route"},resolvedPagePath:"/Users/kumar/Business admin/tripfluence-admin/app/api/listings/[id]/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:h}=m,I="/api/listings/[id]/route";function b(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,147,5972,6608,1909,5344],()=>r(98225));module.exports=i})();