"use strict";(()=>{var e={};e.id=338,e.ids=[338],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},6005:e=>{e.exports=require("node:crypto")},83812:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>P,requestAsyncStorage:()=>O,routeModule:()=>R,serverHooks:()=>N,staticGenerationAsyncStorage:()=>D});var a={};r.r(a),r.d(a,{GET:()=>I,dynamic:()=>p});var o=r(49303),s=r(88716),n=r(60670),i=r(87070),E=r(88879),l=r(9487),_=r(14749),d=r(19163),c=r(53524),u=r(84770);let p="force-dynamic",T=E.Ryn({businessId:E.Z_8().cuid(),provider:E.jbo(c.SocialProvider)}),A={FACEBOOK_PAGE:["pages_manage_posts","pages_read_engagement","pages_show_list","instagram_basic","instagram_content_publish"],INSTAGRAM_BUSINESS:["instagram_basic","instagram_content_publish","pages_show_list"],GOOGLE_BUSINESS:["https://www.googleapis.com/auth/business.manage"],EVENTBRITE:["event:read","event:write","user:read"],MEETUP:["ageless","group_edit","event_management"]},S={FACEBOOK_PAGE:"https://www.facebook.com/v18.0/dialog/oauth",INSTAGRAM_BUSINESS:"https://www.facebook.com/v18.0/dialog/oauth",GOOGLE_BUSINESS:"https://accounts.google.com/o/oauth2/v2/auth",EVENTBRITE:"https://www.eventbrite.com/oauth/authorize",MEETUP:"https://secure.meetup.com/oauth2/authorize"};async function I(e,{params:t}){let{provider:r}=await t;try{let{searchParams:t}=new URL(e.url),a=t.get("businessId"),o=T.safeParse({businessId:a,provider:r});if(!o.success)return i.NextResponse.json({error:"Invalid parameters",details:o.error.errors},{status:400});let{businessId:s,provider:n}=o.data,E=await d.hS.getCurrentUser(e);if(!E)return i.NextResponse.json({error:"Unauthorized"},{status:401});if(!await d.hS.checkPermission(E.id,s,["ADMIN","MANAGER","INFLUENCER"]))return i.NextResponse.json({error:"Insufficient permissions"},{status:403});let c=(0,u.randomBytes)(32).toString("hex"),p=new Date(Date.now()+6e5);await l.db.providerAuthState.create({data:{state:c,provider:n,businessId:s,expiresAt:p}});let I=process.env.OAUTH_REDIRECT_BASE||"http://localhost:3000",R=`${I}/api/auth/callback/${n}`,O=A[n],D=S[n],N=new URLSearchParams({client_id:function(e){switch(e){case"FACEBOOK_PAGE":case"INSTAGRAM_BUSINESS":return process.env.FACEBOOK_APP_ID||"";case"GOOGLE_BUSINESS":return process.env.GOOGLE_CLIENT_ID||"";case"EVENTBRITE":return process.env.EVENTBRITE_CLIENT_ID||"";case"MEETUP":return process.env.MEETUP_CLIENT_ID||"";default:throw Error(`Unknown provider: ${e}`)}}(n),redirect_uri:R,scope:O.join(" "),response_type:"code",state:c});("FACEBOOK_PAGE"===n||"INSTAGRAM_BUSINESS"===n)&&N.append("config_id",function(e){switch(e){case"FACEBOOK_PAGE":return process.env.FACEBOOK_PAGE_CONFIG_ID||"";case"INSTAGRAM_BUSINESS":return process.env.INSTAGRAM_CONFIG_ID||"";default:return""}}(n));let m=`${D}?${N.toString()}`;return await (0,_.ar)(E.id,"user","PROVIDER_CONNECT_ATTEMPT","SocialAccount","temp",s,{provider:n}),i.NextResponse.json({authUrl:m})}catch(e){return console.error("OAuth connect error:",e),i.NextResponse.json({error:"Failed to initiate OAuth connection"},{status:500})}}let R=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/connect/[provider]/route",pathname:"/api/auth/connect/[provider]",filename:"route",bundlePath:"app/api/auth/connect/[provider]/route"},resolvedPagePath:"/Users/kumar/Business admin/tripfluence-admin/app/api/auth/connect/[provider]/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:O,staticGenerationAsyncStorage:D,serverHooks:N}=R,m="/api/auth/connect/[provider]/route";function P(){return(0,n.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:D})}},14749:(e,t,r)=>{r.d(t,{ar:()=>i,sZ:()=>n});var a=r(9487),o=r(57435),s=r(60581);let n={LISTING_CREATED:"listing.created",LISTING_UPDATED:"listing.updated",LISTING_DELETED:"listing.deleted",LISTING_PUBLISHED:"listing.published",LISTING_UNPUBLISHED:"listing.unpublished",ORDER_CREATED:"order.created",ORDER_UPDATED:"order.updated",ORDER_CANCELLED:"order.cancelled",ORDER_REFUNDED:"order.refunded",SLOT_CREATED:"slot.created",SLOT_UPDATED:"slot.updated",SLOT_DELETED:"slot.deleted",SLOTS_IMPORTED:"slots.imported",SLOTS_EXPORTED:"slots.exported",WIDGET_CREATED:"widget.created",WIDGET_UPDATED:"widget.updated",WIDGET_DELETED:"widget.deleted",WIDGET_GENERATED:"widget.generated",SOCIAL_POST_CREATED:"social.post.created",SOCIAL_POST_PUBLISHED:"social.post.published",SOCIAL_POST_FAILED:"social.post.failed",SOCIAL_TEST_POST:"social.test.post",SOCIAL_ACCOUNT_CONNECTED:"social.account.connected",SOCIAL_ACCOUNT_DISCONNECTED:"social.account.disconnected",PROVIDER_CONNECTED:"provider.connected",PROVIDER_DISCONNECTED:"provider.disconnected",PROVIDER_RECONNECT_REQUESTED:"provider.reconnect.requested",PROVIDER_REFRESHED:"provider.refreshed",EVENT_SYNC_CREATED:"event.sync.created",EVENT_SYNC_UPDATED:"event.sync.updated",EVENT_SYNC_DELETED:"event.sync.deleted",EVENT_SYNC_PUBLISHED:"event.sync.published",EVENT_SYNC_IMPORTED:"event.sync.imported",EVENT_PUBLISHED:"event.published",EVENT_UPDATED:"event.updated",EVENT_FAILED:"event.failed",EVENT_TEST_PUBLISH:"event.test.publish",COUPON_CREATED:"coupon.created",COUPON_UPDATED:"coupon.updated",COUPON_DELETED:"coupon.deleted",AFFILIATE_CREATED:"affiliate.created",AFFILIATE_UPDATED:"affiliate.updated",AFFILIATE_DELETED:"affiliate.deleted",SETTINGS_UPDATED:"settings.updated",USER_CREATED:"user.created",USER_UPDATED:"user.updated",USER_DELETED:"user.deleted",WEBHOOK_CREATED:"webhook.created",WEBHOOK_UPDATED:"webhook.updated",WEBHOOK_DELETED:"webhook.deleted",API_KEY_CREATED:"api.key.created",API_KEY_DELETED:"api.key.deleted",LOGIN:"user.login",LOGOUT:"user.logout",PASSWORD_CHANGED:"user.password.changed",PERMISSION_CHANGED:"user.permission.changed"},i=async(e,t,r,n,i,E,l={},_)=>{try{let d=await a.db.auditLog.create({data:{id:(0,s.x0)(),actorId:e,actorType:t,action:r,entityType:n,entityId:i,businessId:E,metadata:JSON.stringify(l),ipAddress:_?.ipAddress,userAgent:_?.userAgent}});return o.k.info(`Audit log created: ${r} on ${n}:${i} by ${t}:${e}`),d}catch(e){throw o.k.error("Failed to create audit log entry:",e),e}}},9487:(e,t,r)=>{r.d(t,{db:()=>i});var a=r(53524),o=r(1964);let s=globalThis,n=()=>({$queryRaw:()=>Promise.resolve([]),$executeRaw:()=>Promise.resolve(0),$transaction:e=>e({}),user:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},business:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},space:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},socialAccount:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},webhookDelivery:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},auditLog:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceAvailability:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceRequest:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)}}),i=(()=>{process.env.SKIP_ENV_VALIDATION;try{return s.prisma??new a.PrismaClient({log:"development"===o.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:o.OB.DATABASE_URL}}})}catch(e){return console.warn("Database connection failed during build, using mock database:",e),n()}return s.prisma??new a.PrismaClient({log:"development"===o.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:o.OB.DATABASE_URL}}})})();"production"!==o.OB.NODE_ENV&&(s.prisma=i)},1964:(e,t,r)=>{r.d(t,{OB:()=>s});var a=r(88879);let o=a.Ryn({DATABASE_URL:a.Z_8().url("Invalid database URL"),REDIS_URL:a.Z_8().url("Invalid Redis URL").optional(),JWT_SECRET:a.Z_8().min(32,"JWT secret must be at least 32 characters"),NEXTAUTH_SECRET:a.Z_8().min(32,"NextAuth secret must be at least 32 characters").optional(),NEXTAUTH_URL:a.Z_8().url("Invalid NextAuth URL").optional(),STRIPE_SECRET_KEY:a.Z_8().startsWith("sk_","Invalid Stripe secret key").optional(),STRIPE_PUBLISHABLE_KEY:a.Z_8().startsWith("pk_","Invalid Stripe publishable key").optional(),STRIPE_WEBHOOK_SECRET:a.Z_8().optional(),RAZORPAY_KEY_ID:a.Z_8().optional(),RAZORPAY_KEY_SECRET:a.Z_8().optional(),RAZORPAY_WEBHOOK_SECRET:a.Z_8().optional(),WEBHOOK_SECRET:a.Z_8().min(32,"Webhook secret must be at least 32 characters"),FACEBOOK_APP_ID:a.Z_8().optional(),FACEBOOK_APP_SECRET:a.Z_8().optional(),FACEBOOK_PAGE_CONFIG_ID:a.Z_8().optional(),INSTAGRAM_CONFIG_ID:a.Z_8().optional(),GOOGLE_CLIENT_ID:a.Z_8().optional(),GOOGLE_CLIENT_SECRET:a.Z_8().optional(),EVENTBRITE_CLIENT_ID:a.Z_8().optional(),EVENTBRITE_CLIENT_SECRET:a.Z_8().optional(),MEETUP_CLIENT_ID:a.Z_8().optional(),MEETUP_CLIENT_SECRET:a.Z_8().optional(),OAUTH_REDIRECT_BASE:a.Z_8().url("Invalid OAuth redirect base URL").optional(),GRAPH_API_BASE:a.Z_8().url("Invalid Graph API base URL").default("https://graph.facebook.com"),GOOGLE_BUSINESS_API_BASE:a.Z_8().url("Invalid Google Business Profile API base URL").default("https://mybusiness.googleapis.com"),ENCRYPTION_KEY:a.Z_8().length(64,"Encryption key must be 64 hex characters (32 bytes)").optional(),FEATURE_REAL_PROVIDERS:a.Z_8().transform(e=>"true"===e).default("false"),SMTP_HOST:a.Z_8().optional(),SMTP_PORT:a.Z_8().transform(Number).optional(),SMTP_USER:a.Z_8().optional(),SMTP_PASSWORD:a.Z_8().optional(),SMTP_FROM:a.Z_8().email("Invalid SMTP from email").optional(),TWILIO_ACCOUNT_SID:a.Z_8().optional(),TWILIO_AUTH_TOKEN:a.Z_8().optional(),TWILIO_PHONE_NUMBER:a.Z_8().optional(),AWS_ACCESS_KEY_ID:a.Z_8().optional(),AWS_SECRET_ACCESS_KEY:a.Z_8().optional(),AWS_REGION:a.Z_8().optional(),AWS_S3_BUCKET:a.Z_8().optional(),SENTRY_DSN:a.Z_8().url("Invalid Sentry DSN").optional(),NODE_ENV:a.KmV(["development","production","test"]).default("development"),PORT:a.Z_8().transform(Number).default("3000")}),s=(()=>{if("true"===process.env.SKIP_ENV_VALIDATION)return{DATABASE_URL:process.env.DATABASE_URL||"postgresql://dummy:dummy@localhost:5432/dummy",JWT_SECRET:process.env.JWT_SECRET||"dummy-jwt-secret-key-minimum-32-characters-long",WEBHOOK_SECRET:process.env.WEBHOOK_SECRET||"dummy-webhook-secret-key-minimum-32-characters-long",NODE_ENV:"production",PORT:process.env.PORT||"3000",FEATURE_REAL_PROVIDERS:!1,GRAPH_API_BASE:"https://graph.facebook.com",GOOGLE_BUSINESS_API_BASE:"https://mybusiness.googleapis.com"};try{return o.parse(process.env)}catch(e){if(e instanceof a.jmq&&e.errors){let t=e.errors.filter(e=>"invalid_type"===e.code&&"undefined"===e.received).map(e=>e.path.join(".")),r=e.errors.filter(e=>"invalid_type"!==e.code).map(e=>`${e.path.join(".")}: ${e.message}`),a="Environment validation failed:\n";throw t.length>0&&(a+=`
Missing required variables:
${t.map(e=>`  - ${e}`).join("\n")}`),r.length>0&&(a+=`
Invalid variables:
${r.map(e=>`  - ${e}`).join("\n")}`),Error(a)}throw e}})();s.NODE_ENV,s.NODE_ENV,s.NODE_ENV},60581:(e,t,r)=>{r.d(t,{x0:()=>a.x0});var a=r(42549);(0,a.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",8),(0,a.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",10),(0,a.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",8)},57435:(e,t,r)=>{r.d(t,{k:()=>a});let a={info:(e,...t)=>{console.log(`[INFO] ${e}`,...t)},warn:(e,...t)=>{console.warn(`[WARN] ${e}`,...t)},error:(e,...t)=>{console.error(`[ERROR] ${e}`,...t)},debug:(e,...t)=>{}}},19163:(e,t,r)=>{r.d(t,{hS:()=>E,rt:()=>s});var a=r(9487),o=r(53524);async function s(e,t,r){try{return!!await a.db.roleAssignment.findFirst({where:{userId:e,businessId:t,role:{in:r}}})}catch(e){return console.error("Error checking RBAC:",e),!1}}async function n(e,t){try{let r=await a.db.roleAssignment.findFirst({where:{userId:e,businessId:t}});return r?.role||null}catch(e){return console.error("Error getting user role:",e),null}}async function i(e,t,r){try{let a=await n(e,t);if(!a)return!1;let s={[o.Role.ADMIN]:["spaces.create","spaces.read","spaces.update","spaces.delete","spaces.publish","requests.read","requests.approve","requests.decline","requests.cancel","pricing.manage","availability.manage","payouts.manage","users.manage","settings.manage"],[o.Role.MANAGER]:["spaces.create","spaces.read","spaces.update","spaces.publish","requests.read","requests.approve","requests.decline","requests.cancel","pricing.manage","availability.manage","payouts.view"],[o.Role.STAFF]:["spaces.read","requests.read","requests.cancel","availability.read"],[o.Role.INFLUENCER]:["spaces.read"]};return s[a]?.includes(r)||!1}catch(e){return console.error("Error checking permission:",e),!1}}let E={checkRBAC:s,getUserRole:n,hasPermission:i}},42549:(e,t,r)=>{let a,o;r.d(t,{kP:()=>i,x0:()=>E});var s=r(6005);function n(e){!a||a.length<e?(a=Buffer.allocUnsafe(128*e),s.webcrypto.getRandomValues(a),o=0):o+e>a.length&&(s.webcrypto.getRandomValues(a),o=0),o+=e}function i(e,t=21){var r;let s,i;return r=t,i=Math.ceil(1.6*(s=(2<<31-Math.clz32(e.length-1|1))-1)*r/e.length),(t=r)=>{if(!t)return"";let E="";for(;;){var l;let r=(n(l=0|i),a.subarray(o-l,o)),_=i;for(;_--;)if((E+=e[r[_]&s]||"").length>=t)return E}}}function E(e=21){n(e|=0);let t="";for(let r=o-e;r<o;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&a[r]];return t}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,147,5972],()=>r(83812));module.exports=a})();