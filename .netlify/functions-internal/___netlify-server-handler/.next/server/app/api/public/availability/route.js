"use strict";(()=>{var e={};e.id=4192,e.ids=[4192],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},21225:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>R,patchFetch:()=>I,requestAsyncStorage:()=>_,routeModule:()=>p,serverHooks:()=>E,staticGenerationAsyncStorage:()=>c});var a={};i.r(a),i.d(a,{GET:()=>u,dynamic:()=>m});var o=i(49303),n=i(88716),r=i(60670),s=i(87070),l=i(9487),d=i(29659);let m="force-dynamic";async function u(e){try{let{searchParams:t}=new URL(e.url),i=d._2.parse({spaceId:t.get("spaceId"),from:t.get("from"),to:t.get("to")});if(!await l.db.space.findFirst({where:{id:i.spaceId,status:"PUBLISHED"}}))return s.NextResponse.json({error:"Space not found"},{status:404});let a=await l.db.spaceAvailability.findMany({where:{spaceId:i.spaceId,OR:[{start:{gte:i.from,lte:i.to}},{end:{gte:i.from,lte:i.to}},{AND:[{start:{lte:i.from}},{end:{gte:i.to}}]}]},orderBy:{start:"asc"}}),o=await l.db.spaceRequest.findMany({where:{spaceId:i.spaceId,status:"CONFIRMED",OR:[{start:{gte:i.from,lte:i.to}},{end:{gte:i.from,lte:i.to}},{AND:[{start:{lte:i.from}},{end:{gte:i.to}}]}]},select:{start:!0,end:!0,title:!0}});return s.NextResponse.json({availability:a,confirmedRequests:o})}catch(e){if(console.error("Error fetching public availability:",e),e instanceof Error&&"ZodError"===e.name)return s.NextResponse.json({error:"Invalid input data",details:e.message},{status:400});return s.NextResponse.json({error:"Failed to fetch availability"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/public/availability/route",pathname:"/api/public/availability",filename:"route",bundlePath:"app/api/public/availability/route"},resolvedPagePath:"/Users/kumar/Business admin/tripfluence-admin/app/api/public/availability/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:_,staticGenerationAsyncStorage:c,serverHooks:E}=p,R="/api/public/availability/route";function I(){return(0,r.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:c})}},9487:(e,t,i)=>{i.d(t,{db:()=>s});var a=i(53524),o=i(1964);let n=globalThis,r=()=>({$queryRaw:()=>Promise.resolve([]),$executeRaw:()=>Promise.resolve(0),$transaction:e=>e({}),user:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},business:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},space:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},socialAccount:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},webhookDelivery:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},auditLog:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceAvailability:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceRequest:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)}}),s=(()=>{process.env.SKIP_ENV_VALIDATION;try{return n.prisma??new a.PrismaClient({log:"development"===o.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:o.OB.DATABASE_URL}}})}catch(e){return console.warn("Database connection failed during build, using mock database:",e),r()}return n.prisma??new a.PrismaClient({log:"development"===o.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:o.OB.DATABASE_URL}}})})();"production"!==o.OB.NODE_ENV&&(n.prisma=s)},1964:(e,t,i)=>{i.d(t,{OB:()=>n});var a=i(88879);let o=a.Ryn({DATABASE_URL:a.Z_8().url("Invalid database URL"),REDIS_URL:a.Z_8().url("Invalid Redis URL").optional(),JWT_SECRET:a.Z_8().min(32,"JWT secret must be at least 32 characters"),NEXTAUTH_SECRET:a.Z_8().min(32,"NextAuth secret must be at least 32 characters").optional(),NEXTAUTH_URL:a.Z_8().url("Invalid NextAuth URL").optional(),STRIPE_SECRET_KEY:a.Z_8().startsWith("sk_","Invalid Stripe secret key").optional(),STRIPE_PUBLISHABLE_KEY:a.Z_8().startsWith("pk_","Invalid Stripe publishable key").optional(),STRIPE_WEBHOOK_SECRET:a.Z_8().optional(),RAZORPAY_KEY_ID:a.Z_8().optional(),RAZORPAY_KEY_SECRET:a.Z_8().optional(),RAZORPAY_WEBHOOK_SECRET:a.Z_8().optional(),WEBHOOK_SECRET:a.Z_8().min(32,"Webhook secret must be at least 32 characters"),FACEBOOK_APP_ID:a.Z_8().optional(),FACEBOOK_APP_SECRET:a.Z_8().optional(),FACEBOOK_PAGE_CONFIG_ID:a.Z_8().optional(),INSTAGRAM_CONFIG_ID:a.Z_8().optional(),GOOGLE_CLIENT_ID:a.Z_8().optional(),GOOGLE_CLIENT_SECRET:a.Z_8().optional(),EVENTBRITE_CLIENT_ID:a.Z_8().optional(),EVENTBRITE_CLIENT_SECRET:a.Z_8().optional(),MEETUP_CLIENT_ID:a.Z_8().optional(),MEETUP_CLIENT_SECRET:a.Z_8().optional(),OAUTH_REDIRECT_BASE:a.Z_8().url("Invalid OAuth redirect base URL").optional(),GRAPH_API_BASE:a.Z_8().url("Invalid Graph API base URL").default("https://graph.facebook.com"),GOOGLE_BUSINESS_API_BASE:a.Z_8().url("Invalid Google Business Profile API base URL").default("https://mybusiness.googleapis.com"),ENCRYPTION_KEY:a.Z_8().length(64,"Encryption key must be 64 hex characters (32 bytes)").optional(),FEATURE_REAL_PROVIDERS:a.Z_8().transform(e=>"true"===e).default("false"),SMTP_HOST:a.Z_8().optional(),SMTP_PORT:a.Z_8().transform(Number).optional(),SMTP_USER:a.Z_8().optional(),SMTP_PASSWORD:a.Z_8().optional(),SMTP_FROM:a.Z_8().email("Invalid SMTP from email").optional(),TWILIO_ACCOUNT_SID:a.Z_8().optional(),TWILIO_AUTH_TOKEN:a.Z_8().optional(),TWILIO_PHONE_NUMBER:a.Z_8().optional(),AWS_ACCESS_KEY_ID:a.Z_8().optional(),AWS_SECRET_ACCESS_KEY:a.Z_8().optional(),AWS_REGION:a.Z_8().optional(),AWS_S3_BUCKET:a.Z_8().optional(),SENTRY_DSN:a.Z_8().url("Invalid Sentry DSN").optional(),NODE_ENV:a.KmV(["development","production","test"]).default("development"),PORT:a.Z_8().transform(Number).default("3000")}),n=(()=>{if("true"===process.env.SKIP_ENV_VALIDATION)return{DATABASE_URL:process.env.DATABASE_URL||"postgresql://dummy:dummy@localhost:5432/dummy",JWT_SECRET:process.env.JWT_SECRET||"dummy-jwt-secret-key-minimum-32-characters-long",WEBHOOK_SECRET:process.env.WEBHOOK_SECRET||"dummy-webhook-secret-key-minimum-32-characters-long",NODE_ENV:"production",PORT:process.env.PORT||"3000",FEATURE_REAL_PROVIDERS:!1,GRAPH_API_BASE:"https://graph.facebook.com",GOOGLE_BUSINESS_API_BASE:"https://mybusiness.googleapis.com"};try{return o.parse(process.env)}catch(e){if(e instanceof a.jmq&&e.errors){let t=e.errors.filter(e=>"invalid_type"===e.code&&"undefined"===e.received).map(e=>e.path.join(".")),i=e.errors.filter(e=>"invalid_type"!==e.code).map(e=>`${e.path.join(".")}: ${e.message}`),a="Environment validation failed:\n";throw t.length>0&&(a+=`
Missing required variables:
${t.map(e=>`  - ${e}`).join("\n")}`),i.length>0&&(a+=`
Invalid variables:
${i.map(e=>`  - ${e}`).join("\n")}`),Error(a)}throw e}})();n.NODE_ENV,n.NODE_ENV,n.NODE_ENV},29659:(e,t,i)=>{i.d(t,{Aw:()=>m,BP:()=>_,Cc:()=>r,GW:()=>A,IZ:()=>n,QU:()=>l,W7:()=>E,Xu:()=>p,Yp:()=>R,_2:()=>I,mD:()=>c,pJ:()=>Z,qe:()=>o,r:()=>u,x1:()=>y});var a=i(88879);let o=a.Ryn({title:a.Z_8().min(1,"Title is required").max(100,"Title too long"),slug:a.Z_8().min(1,"Slug is required").max(50,"Slug too long").regex(/^[a-z0-9-]+$/,"Slug must contain only lowercase letters, numbers, and hyphens"),description:a.Z_8().min(10,"Description must be at least 10 characters").max(1e3,"Description too long"),photos:a.IXX(a.Z_8().url("Invalid photo URL")).max(10,"Maximum 10 photos allowed"),location:a.Ryn({address:a.Z_8().min(1,"Address is required"),lat:a.Rxh().min(-90).max(90),lng:a.Rxh().min(-180).max(180)}),capacity:a.Rxh().int().min(1,"Capacity must be at least 1").max(1e3,"Capacity too large"),floorAreaM2:a.Rxh().int().min(1).max(1e4).optional(),amenities:a.IXX(a.Ryn({label:a.Z_8().min(1,"Amenity label is required"),category:a.Z_8().optional()})).max(20,"Maximum 20 amenities allowed"),rules:a.IXX(a.Ryn({label:a.Z_8().min(1,"Rule label is required"),required:a.O72()})).max(10,"Maximum 10 rules allowed")}),n=o.partial().extend({id:a.Z_8().cuid()}),r=a.Ryn({id:a.Z_8().cuid()}),s=a.Ryn({kind:a.KmV(["HOURLY","DAILY","PEAK","CLEANING_FEE","SECURITY_DEPOSIT"]),amount:a.Rxh().int().min(0,"Amount must be positive"),currency:a.Z_8().length(3,"Currency must be 3 characters"),dow:a.IXX(a.Rxh().int().min(0).max(6)).default([]),startHour:a.Rxh().int().min(0).max(23).optional(),endHour:a.Rxh().int().min(0).max(23).optional()}).refine(e=>void 0===e.startHour||void 0===e.endHour||e.startHour<e.endHour,{message:"Start hour must be before end hour",path:["endHour"]}),l=a.Ryn({spaceId:a.Z_8().cuid(),rules:a.IXX(s).max(10,"Maximum 10 pricing rules allowed")}),d=a.Ryn({spaceId:a.Z_8().cuid(),start:a.oQ2.date(),end:a.oQ2.date(),isBlocked:a.O72().default(!1),notes:a.Z_8().max(500).optional()}).refine(e=>e.start<e.end,{message:"Start time must be before end time",path:["end"]}),m=a.Ryn({spaceId:a.Z_8().cuid(),blocks:a.IXX(d.omit({spaceId:!0})).max(50,"Maximum 50 availability blocks allowed")}),u=a.Ryn({spaceId:a.Z_8().cuid(),title:a.Z_8().min(1,"Title is required").max(100,"Title too long"),description:a.Z_8().max(500).optional(),attendees:a.Rxh().int().min(1,"At least 1 attendee required").max(1e3,"Too many attendees"),start:a.oQ2.date(),end:a.oQ2.date(),organizerId:a.Z_8().min(1,"Organizer ID is required")}).refine(e=>e.start<e.end,{message:"Start time must be before end time",path:["end"]}).refine(e=>e.end.getTime()-e.start.getTime()<=864e5,{message:"Booking duration cannot exceed 24 hours",path:["end"]}),p=a.Ryn({requestId:a.Z_8().cuid(),quoteAmount:a.Rxh().int().min(0,"Quote amount must be positive"),depositAmount:a.Rxh().int().min(0).optional(),cleaningFee:a.Rxh().int().min(0).optional(),pricingBreakdown:a.IMB(a.YjB())}),_=a.Ryn({requestId:a.Z_8().cuid(),decision:a.KmV(["approve","decline"]),message:a.Z_8().max(500).optional()}),c=a.Ryn({requestId:a.Z_8().cuid(),reason:a.Z_8().max(200).optional()}),E=a.Ryn({spaceReqId:a.Z_8().cuid(),body:a.Z_8().min(1,"Message body is required").max(1e3,"Message too long"),attachments:a.IXX(a.Z_8().url("Invalid attachment URL")).max(5,"Maximum 5 attachments allowed").optional()});a.Ryn({requestId:a.Z_8().cuid(),paymentMethodId:a.Z_8().min(1,"Payment method is required"),idempotencyKey:a.Z_8().uuid("Invalid idempotency key")}),a.Ryn({businessId:a.Z_8().cuid(),returnUrl:a.Z_8().url("Invalid return URL").optional(),refreshUrl:a.Z_8().url("Invalid refresh URL").optional()});let R=a.Ryn({city:a.Z_8().optional(),priceMin:a.oQ2.number().int().min(0).optional(),priceMax:a.oQ2.number().int().min(0).optional(),capacity:a.oQ2.number().int().min(1).optional(),amenities:a.IXX(a.Z_8()).optional(),from:a.oQ2.date().optional(),to:a.oQ2.date().optional(),page:a.oQ2.number().int().min(1).default(1),limit:a.oQ2.number().int().min(1).max(50).default(24),sort:a.KmV(["relevance","price_asc","price_desc","capacity","distance"]).default("relevance"),lat:a.oQ2.number().optional(),lng:a.oQ2.number().optional(),radius:a.oQ2.number().int().min(1).max(100).default(50)}),I=a.Ryn({spaceId:a.Z_8().cuid(),from:a.oQ2.date(),to:a.oQ2.date()}),y=a.Ryn({spaceId:a.Z_8().cuid(),start:a.oQ2.date(),end:a.oQ2.date(),attendees:a.Rxh().int().min(1).max(1e3)});a.Ryn({q:a.Z_8().min(1,"Search query is required").max(100,"Query too long"),filters:a.Ryn({city:a.Z_8().optional(),priceRange:a.bcc([a.Rxh(),a.Rxh()]).optional(),capacity:a.Rxh().int().min(1).optional(),amenities:a.IXX(a.Z_8()).optional()}).optional(),page:a.oQ2.number().int().min(1).default(1),limit:a.oQ2.number().int().min(1).max(50).default(20)});let A=a.Ryn({status:a.KmV(["DRAFT","PUBLISHED","ARCHIVED"]).optional(),city:a.Z_8().optional(),capacity:a.oQ2.number().int().min(1).optional(),q:a.Z_8().optional(),page:a.oQ2.number().int().min(1).default(1),limit:a.oQ2.number().int().min(1).max(100).default(20)}),Z=a.Ryn({status:a.KmV(["PENDING","APPROVED","DECLINED","CANCELLED"]).optional(),spaceId:a.Z_8().cuid().optional(),from:a.oQ2.date().optional(),to:a.oQ2.date().optional(),page:a.oQ2.number().int().min(1).default(1),limit:a.oQ2.number().int().min(1).max(100).default(20)})}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[8948,147,5972],()=>i(21225));module.exports=a})();