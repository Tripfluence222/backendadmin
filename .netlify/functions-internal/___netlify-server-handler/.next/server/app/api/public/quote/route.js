"use strict";(()=>{var e={};e.id=3519,e.ids=[3519],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},64536:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>R,patchFetch:()=>I,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>E,staticGenerationAsyncStorage:()=>_});var n={};i.r(n),i.d(n,{POST:()=>m});var a=i(49303),o=i(88716),r=i(60670),s=i(87070),l=i(9487),u=i(29659),d=i(67829);async function m(e){try{let t=await e.json(),i=u.x1.parse(t),n=await l.db.space.findFirst({where:{id:i.spaceId,status:"PUBLISHED"},include:{pricingRules:!0}});if(!n)return s.NextResponse.json({error:"Space not found"},{status:404});if(i.attendees>n.capacity)return s.NextResponse.json({error:`Space capacity is ${n.capacity}, requested ${i.attendees}`},{status:400});let a=(0,d.Z4)(n,n.pricingRules,{start:i.start,end:i.end,attendees:i.attendees});return s.NextResponse.json(a)}catch(e){if(console.error("Error calculating quote:",e),e instanceof Error&&"ZodError"===e.name)return s.NextResponse.json({error:"Invalid input data",details:e.message},{status:400});return s.NextResponse.json({error:"Failed to calculate quote"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/public/quote/route",pathname:"/api/public/quote",filename:"route",bundlePath:"app/api/public/quote/route"},resolvedPagePath:"/Users/kumar/Business admin/tripfluence-admin/app/api/public/quote/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:_,serverHooks:E}=p,R="/api/public/quote/route";function I(){return(0,r.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:_})}},9487:(e,t,i)=>{i.d(t,{db:()=>s});var n=i(53524),a=i(1964);let o=globalThis,r=()=>({$queryRaw:()=>Promise.resolve([]),$executeRaw:()=>Promise.resolve(0),$transaction:e=>e({}),user:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},business:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},space:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},socialAccount:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},webhookDelivery:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},auditLog:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceAvailability:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceRequest:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)}}),s=(()=>{process.env.SKIP_ENV_VALIDATION;try{return o.prisma??new n.PrismaClient({log:"development"===a.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:a.OB.DATABASE_URL}}})}catch(e){return console.warn("Database connection failed during build, using mock database:",e),r()}return o.prisma??new n.PrismaClient({log:"development"===a.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:a.OB.DATABASE_URL}}})})();"production"!==a.OB.NODE_ENV&&(o.prisma=s)},1964:(e,t,i)=>{i.d(t,{OB:()=>o});var n=i(88879);let a=n.Ryn({DATABASE_URL:n.Z_8().url("Invalid database URL"),REDIS_URL:n.Z_8().url("Invalid Redis URL").optional(),JWT_SECRET:n.Z_8().min(32,"JWT secret must be at least 32 characters"),NEXTAUTH_SECRET:n.Z_8().min(32,"NextAuth secret must be at least 32 characters").optional(),NEXTAUTH_URL:n.Z_8().url("Invalid NextAuth URL").optional(),STRIPE_SECRET_KEY:n.Z_8().startsWith("sk_","Invalid Stripe secret key").optional(),STRIPE_PUBLISHABLE_KEY:n.Z_8().startsWith("pk_","Invalid Stripe publishable key").optional(),STRIPE_WEBHOOK_SECRET:n.Z_8().optional(),RAZORPAY_KEY_ID:n.Z_8().optional(),RAZORPAY_KEY_SECRET:n.Z_8().optional(),RAZORPAY_WEBHOOK_SECRET:n.Z_8().optional(),WEBHOOK_SECRET:n.Z_8().min(32,"Webhook secret must be at least 32 characters"),FACEBOOK_APP_ID:n.Z_8().optional(),FACEBOOK_APP_SECRET:n.Z_8().optional(),FACEBOOK_PAGE_CONFIG_ID:n.Z_8().optional(),INSTAGRAM_CONFIG_ID:n.Z_8().optional(),GOOGLE_CLIENT_ID:n.Z_8().optional(),GOOGLE_CLIENT_SECRET:n.Z_8().optional(),EVENTBRITE_CLIENT_ID:n.Z_8().optional(),EVENTBRITE_CLIENT_SECRET:n.Z_8().optional(),MEETUP_CLIENT_ID:n.Z_8().optional(),MEETUP_CLIENT_SECRET:n.Z_8().optional(),OAUTH_REDIRECT_BASE:n.Z_8().url("Invalid OAuth redirect base URL").optional(),GRAPH_API_BASE:n.Z_8().url("Invalid Graph API base URL").default("https://graph.facebook.com"),GOOGLE_BUSINESS_API_BASE:n.Z_8().url("Invalid Google Business Profile API base URL").default("https://mybusiness.googleapis.com"),ENCRYPTION_KEY:n.Z_8().length(64,"Encryption key must be 64 hex characters (32 bytes)").optional(),FEATURE_REAL_PROVIDERS:n.Z_8().transform(e=>"true"===e).default("false"),SMTP_HOST:n.Z_8().optional(),SMTP_PORT:n.Z_8().transform(Number).optional(),SMTP_USER:n.Z_8().optional(),SMTP_PASSWORD:n.Z_8().optional(),SMTP_FROM:n.Z_8().email("Invalid SMTP from email").optional(),TWILIO_ACCOUNT_SID:n.Z_8().optional(),TWILIO_AUTH_TOKEN:n.Z_8().optional(),TWILIO_PHONE_NUMBER:n.Z_8().optional(),AWS_ACCESS_KEY_ID:n.Z_8().optional(),AWS_SECRET_ACCESS_KEY:n.Z_8().optional(),AWS_REGION:n.Z_8().optional(),AWS_S3_BUCKET:n.Z_8().optional(),SENTRY_DSN:n.Z_8().url("Invalid Sentry DSN").optional(),NODE_ENV:n.KmV(["development","production","test"]).default("development"),PORT:n.Z_8().transform(Number).default("3000")}),o=(()=>{if("true"===process.env.SKIP_ENV_VALIDATION)return{DATABASE_URL:process.env.DATABASE_URL||"postgresql://dummy:dummy@localhost:5432/dummy",JWT_SECRET:process.env.JWT_SECRET||"dummy-jwt-secret-key-minimum-32-characters-long",WEBHOOK_SECRET:process.env.WEBHOOK_SECRET||"dummy-webhook-secret-key-minimum-32-characters-long",NODE_ENV:"production",PORT:process.env.PORT||"3000",FEATURE_REAL_PROVIDERS:!1,GRAPH_API_BASE:"https://graph.facebook.com",GOOGLE_BUSINESS_API_BASE:"https://mybusiness.googleapis.com"};try{return a.parse(process.env)}catch(e){if(e instanceof n.jmq&&e.errors){let t=e.errors.filter(e=>"invalid_type"===e.code&&"undefined"===e.received).map(e=>e.path.join(".")),i=e.errors.filter(e=>"invalid_type"!==e.code).map(e=>`${e.path.join(".")}: ${e.message}`),n="Environment validation failed:\n";throw t.length>0&&(n+=`
Missing required variables:
${t.map(e=>`  - ${e}`).join("\n")}`),i.length>0&&(n+=`
Invalid variables:
${i.map(e=>`  - ${e}`).join("\n")}`),Error(n)}throw e}})();o.NODE_ENV,o.NODE_ENV,o.NODE_ENV},67829:(e,t,i)=>{i.d(t,{Z4:()=>a,h0:()=>o,lx:()=>r});var n=i(53524);function a(e,t,i){let a=i.end.getTime()-i.start.getTime(),o=Math.ceil(a/36e5),r=Math.ceil(a/864e5),s=[],l=0,u=0,d=0,m=0,p=0,c=t.find(e=>e.kind===n.PricingKind.HOURLY),_=t.find(e=>e.kind===n.PricingKind.DAILY);if(_&&o>=8&&_){let e=_.amount*r;u=e,s.push({label:`Daily rate (${r} day${r>1?"s":""})`,amount:e,kind:n.PricingKind.DAILY})}else if(c){let e=c.amount*o;u=e,s.push({label:`Hourly rate (${o} hour${o>1?"s":""})`,amount:e,kind:n.PricingKind.HOURLY})}let E=t.find(e=>e.kind===n.PricingKind.PEAK);if(E&&function(e,t,i){if(i.dow&&i.dow.length>0){let n=e.getDay(),a=t.getDay();if(!i.dow.some(e=>n<=a?e>=n&&e<=a:e>=n||e<=a))return!1}if(null!==i.startHour&&null!==i.endHour){let n=e.getHours();return!(t.getHours()<=i.startHour||n>=i.endHour)}return!0}(i.start,i.end,E)){let e=function(e,t,i){let n=Math.ceil((i.end.getTime()-i.start.getTime())/36e5);return Math.round(Math.max(0,t.amount-e/n)*n)}(u,E,i);e>0&&(d=e,s.push({label:"Peak time surcharge",amount:e,kind:n.PricingKind.PEAK}))}let R=t.find(e=>e.kind===n.PricingKind.CLEANING_FEE);R&&(m=R.amount,s.push({label:"Cleaning fee",amount:m,kind:n.PricingKind.CLEANING_FEE}));let I=t.find(e=>e.kind===n.PricingKind.SECURITY_DEPOSIT);I&&(p=I.amount,s.push({label:"Security deposit",amount:p,kind:n.PricingKind.SECURITY_DEPOSIT}));let h=(l=u+d+m)+p;return{lines:s,subtotal:l,total:h,currency:t[0]?.currency||"USD",breakdown:{base:u,peak:d,cleaning:m,deposit:p}}}function o(e){let t=e.find(e=>e.kind===n.PricingKind.HOURLY),i=e.find(e=>e.kind===n.PricingKind.DAILY),a=t?.amount||0;if(i){let e=Math.ceil(i.amount/8);a=a>0?Math.min(a,e):e}return a}function r(e){let t=[],i=e.some(e=>e.kind===n.PricingKind.HOURLY),a=e.some(e=>e.kind===n.PricingKind.DAILY);i||a||t.push("At least one base pricing rule (hourly or daily) is required");let o=e.map(e=>e.kind),r=o.filter((e,t)=>o.indexOf(e)!==t);for(let i of(r.length>0&&t.push(`Duplicate pricing rule types: ${r.join(", ")}`),e.filter(e=>e.kind===n.PricingKind.PEAK)))i.dow&&0===i.dow.length&&(null===i.startHour||null===i.endHour)&&t.push("Peak pricing rule must specify either days of week or time range");return t}},29659:(e,t,i)=>{i.d(t,{Aw:()=>d,BP:()=>c,Cc:()=>r,GW:()=>y,IZ:()=>o,QU:()=>l,W7:()=>E,Xu:()=>p,Yp:()=>R,_2:()=>I,mD:()=>_,pJ:()=>f,qe:()=>a,r:()=>m,x1:()=>h});var n=i(88879);let a=n.Ryn({title:n.Z_8().min(1,"Title is required").max(100,"Title too long"),slug:n.Z_8().min(1,"Slug is required").max(50,"Slug too long").regex(/^[a-z0-9-]+$/,"Slug must contain only lowercase letters, numbers, and hyphens"),description:n.Z_8().min(10,"Description must be at least 10 characters").max(1e3,"Description too long"),photos:n.IXX(n.Z_8().url("Invalid photo URL")).max(10,"Maximum 10 photos allowed"),location:n.Ryn({address:n.Z_8().min(1,"Address is required"),lat:n.Rxh().min(-90).max(90),lng:n.Rxh().min(-180).max(180)}),capacity:n.Rxh().int().min(1,"Capacity must be at least 1").max(1e3,"Capacity too large"),floorAreaM2:n.Rxh().int().min(1).max(1e4).optional(),amenities:n.IXX(n.Ryn({label:n.Z_8().min(1,"Amenity label is required"),category:n.Z_8().optional()})).max(20,"Maximum 20 amenities allowed"),rules:n.IXX(n.Ryn({label:n.Z_8().min(1,"Rule label is required"),required:n.O72()})).max(10,"Maximum 10 rules allowed")}),o=a.partial().extend({id:n.Z_8().cuid()}),r=n.Ryn({id:n.Z_8().cuid()}),s=n.Ryn({kind:n.KmV(["HOURLY","DAILY","PEAK","CLEANING_FEE","SECURITY_DEPOSIT"]),amount:n.Rxh().int().min(0,"Amount must be positive"),currency:n.Z_8().length(3,"Currency must be 3 characters"),dow:n.IXX(n.Rxh().int().min(0).max(6)).default([]),startHour:n.Rxh().int().min(0).max(23).optional(),endHour:n.Rxh().int().min(0).max(23).optional()}).refine(e=>void 0===e.startHour||void 0===e.endHour||e.startHour<e.endHour,{message:"Start hour must be before end hour",path:["endHour"]}),l=n.Ryn({spaceId:n.Z_8().cuid(),rules:n.IXX(s).max(10,"Maximum 10 pricing rules allowed")}),u=n.Ryn({spaceId:n.Z_8().cuid(),start:n.oQ2.date(),end:n.oQ2.date(),isBlocked:n.O72().default(!1),notes:n.Z_8().max(500).optional()}).refine(e=>e.start<e.end,{message:"Start time must be before end time",path:["end"]}),d=n.Ryn({spaceId:n.Z_8().cuid(),blocks:n.IXX(u.omit({spaceId:!0})).max(50,"Maximum 50 availability blocks allowed")}),m=n.Ryn({spaceId:n.Z_8().cuid(),title:n.Z_8().min(1,"Title is required").max(100,"Title too long"),description:n.Z_8().max(500).optional(),attendees:n.Rxh().int().min(1,"At least 1 attendee required").max(1e3,"Too many attendees"),start:n.oQ2.date(),end:n.oQ2.date(),organizerId:n.Z_8().min(1,"Organizer ID is required")}).refine(e=>e.start<e.end,{message:"Start time must be before end time",path:["end"]}).refine(e=>e.end.getTime()-e.start.getTime()<=864e5,{message:"Booking duration cannot exceed 24 hours",path:["end"]}),p=n.Ryn({requestId:n.Z_8().cuid(),quoteAmount:n.Rxh().int().min(0,"Quote amount must be positive"),depositAmount:n.Rxh().int().min(0).optional(),cleaningFee:n.Rxh().int().min(0).optional(),pricingBreakdown:n.IMB(n.YjB())}),c=n.Ryn({requestId:n.Z_8().cuid(),decision:n.KmV(["approve","decline"]),message:n.Z_8().max(500).optional()}),_=n.Ryn({requestId:n.Z_8().cuid(),reason:n.Z_8().max(200).optional()}),E=n.Ryn({spaceReqId:n.Z_8().cuid(),body:n.Z_8().min(1,"Message body is required").max(1e3,"Message too long"),attachments:n.IXX(n.Z_8().url("Invalid attachment URL")).max(5,"Maximum 5 attachments allowed").optional()});n.Ryn({requestId:n.Z_8().cuid(),paymentMethodId:n.Z_8().min(1,"Payment method is required"),idempotencyKey:n.Z_8().uuid("Invalid idempotency key")}),n.Ryn({businessId:n.Z_8().cuid(),returnUrl:n.Z_8().url("Invalid return URL").optional(),refreshUrl:n.Z_8().url("Invalid refresh URL").optional()});let R=n.Ryn({city:n.Z_8().optional(),priceMin:n.oQ2.number().int().min(0).optional(),priceMax:n.oQ2.number().int().min(0).optional(),capacity:n.oQ2.number().int().min(1).optional(),amenities:n.IXX(n.Z_8()).optional(),from:n.oQ2.date().optional(),to:n.oQ2.date().optional(),page:n.oQ2.number().int().min(1).default(1),limit:n.oQ2.number().int().min(1).max(50).default(24),sort:n.KmV(["relevance","price_asc","price_desc","capacity","distance"]).default("relevance"),lat:n.oQ2.number().optional(),lng:n.oQ2.number().optional(),radius:n.oQ2.number().int().min(1).max(100).default(50)}),I=n.Ryn({spaceId:n.Z_8().cuid(),from:n.oQ2.date(),to:n.oQ2.date()}),h=n.Ryn({spaceId:n.Z_8().cuid(),start:n.oQ2.date(),end:n.oQ2.date(),attendees:n.Rxh().int().min(1).max(1e3)});n.Ryn({q:n.Z_8().min(1,"Search query is required").max(100,"Query too long"),filters:n.Ryn({city:n.Z_8().optional(),priceRange:n.bcc([n.Rxh(),n.Rxh()]).optional(),capacity:n.Rxh().int().min(1).optional(),amenities:n.IXX(n.Z_8()).optional()}).optional(),page:n.oQ2.number().int().min(1).default(1),limit:n.oQ2.number().int().min(1).max(50).default(20)});let y=n.Ryn({status:n.KmV(["DRAFT","PUBLISHED","ARCHIVED"]).optional(),city:n.Z_8().optional(),capacity:n.oQ2.number().int().min(1).optional(),q:n.Z_8().optional(),page:n.oQ2.number().int().min(1).default(1),limit:n.oQ2.number().int().min(1).max(100).default(20)}),f=n.Ryn({status:n.KmV(["PENDING","APPROVED","DECLINED","CANCELLED"]).optional(),spaceId:n.Z_8().cuid().optional(),from:n.oQ2.date().optional(),to:n.oQ2.date().optional(),page:n.oQ2.number().int().min(1).default(1),limit:n.oQ2.number().int().min(1).max(100).default(20)})}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),n=t.X(0,[8948,147,5972],()=>i(64536));module.exports=n})();