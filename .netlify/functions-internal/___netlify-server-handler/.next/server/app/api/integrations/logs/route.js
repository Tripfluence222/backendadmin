"use strict";(()=>{var e={};e.id=4863,e.ids=[4863],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63268:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>E,serverHooks:()=>A,staticGenerationAsyncStorage:()=>m});var o={};r.r(o),r.d(o,{GET:()=>_,dynamic:()=>p});var s=r(49303),n=r(88716),a=r(60670),i=r(87070),l=r(88879),d=r(9487),u=r(31402),c=r(90455);let p="force-dynamic",f=l.Ryn({businessId:l.Z_8().cuid(),type:l.KmV(["all","webhook","audit"]).default("all"),limit:l.Rxh().int().positive().max(100).default(50),offset:l.Rxh().int().min(0).default(0)});async function _(e){try{let t=await (0,c.mk)(e);(0,c.Ql)(t,"integrations:read");let{searchParams:r}=new URL(e.url),o=f.parse({businessId:r.get("businessId")||t?.businessId||"default",type:r.get("type")||"all",limit:parseInt(r.get("limit")||"50"),offset:parseInt(r.get("offset")||"0")});if(t?.businessId&&t.businessId!==o.businessId)return i.NextResponse.json({error:"Access denied"},{status:403});let s=[];if("all"===o.type||"webhook"===o.type)try{let e=await d.db.webhookDelivery.findMany({where:{businessId:o.businessId},orderBy:{createdAt:"desc"},take:o.limit,skip:o.offset});s.push(...(e||[]).map(e=>({id:e.id,type:"webhook",createdAt:e.createdAt,eventType:e.eventType,status:e.status,durationMs:e.durationMs,requestBody:e.requestBody,responseBody:e.responseBody,endpointId:e.endpointId})))}catch(e){console.warn("Webhook logs table not available:",e)}if("all"===o.type||"audit"===o.type)try{let e=await d.db.auditLog.findMany({where:{businessId:o.businessId,action:{in:["PROVIDER_CONNECTED","PROVIDER_DISCONNECTED","PROVIDER_RECONNECT_REQUESTED","PROVIDER_REFRESHED","SOCIAL_POST_PUBLISHED","SOCIAL_POST_FAILED","SOCIAL_TEST_POST","EVENT_PUBLISHED","EVENT_UPDATED","EVENT_FAILED","EVENT_TEST_PUBLISH"]}},orderBy:{createdAt:"desc"},take:o.limit,skip:o.offset});s.push(...(e||[]).map(e=>({id:e.id,type:"audit",createdAt:e.createdAt,action:e.action,entityType:e.entityType,entityId:e.entityId,actorType:e.actorType,actorId:e.actorId,metadata:e.metadata})))}catch(e){console.warn("Audit logs table not available:",e)}s.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());let n=s.slice(0,o.limit);return(0,u.ok)({logs:n,total:s.length,hasMore:s.length>o.limit})}catch(e){if(e instanceof l.jmq)return(0,u.lI)("Invalid query parameters",e.errors);return(0,u.Vm)("Failed to fetch integration logs",e)}}let E=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/integrations/logs/route",pathname:"/api/integrations/logs",filename:"route",bundlePath:"app/api/integrations/logs/route"},resolvedPagePath:"/Users/kumar/Business admin/tripfluence-admin/app/api/integrations/logs/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:m,serverHooks:A}=E,R="/api/integrations/logs/route";function h(){return(0,a.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:m})}},90455:(e,t,r)=>{r.d(t,{Ql:()=>i,mk:()=>a,ts:()=>n});var o=r(71615),s=r(9487);async function n(){try{let e=(0,o.cookies)(),t=e.get("user-id")?.value;if(!t)return null;let r=await s.db.user.findUnique({where:{id:t},select:{id:!0,email:!0,firstName:!0,lastName:!0,businessId:!0,isActive:!0,lastLoginAt:!0}});if(!r||!r.isActive)return null;return r}catch(e){return console.error("Error getting current user:",e),null}}async function a(){let e=await n();if(!e)throw Error("Authentication required");return e}async function i(e){return await a()}},9487:(e,t,r)=>{r.d(t,{db:()=>i});var o=r(53524),s=r(1964);let n=globalThis,a=()=>({$queryRaw:()=>Promise.resolve([]),$executeRaw:()=>Promise.resolve(0),$transaction:e=>e({}),user:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},business:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},space:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},socialAccount:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},webhookDelivery:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},auditLog:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceAvailability:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceRequest:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)}}),i=(()=>{process.env.SKIP_ENV_VALIDATION;try{return n.prisma??new o.PrismaClient({log:"development"===s.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:s.OB.DATABASE_URL}}})}catch(e){return console.warn("Database connection failed during build, using mock database:",e),a()}return n.prisma??new o.PrismaClient({log:"development"===s.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:s.OB.DATABASE_URL}}})})();"production"!==s.OB.NODE_ENV&&(n.prisma=i)},1964:(e,t,r)=>{r.d(t,{OB:()=>n});var o=r(88879);let s=o.Ryn({DATABASE_URL:o.Z_8().url("Invalid database URL"),REDIS_URL:o.Z_8().url("Invalid Redis URL").optional(),JWT_SECRET:o.Z_8().min(32,"JWT secret must be at least 32 characters"),NEXTAUTH_SECRET:o.Z_8().min(32,"NextAuth secret must be at least 32 characters").optional(),NEXTAUTH_URL:o.Z_8().url("Invalid NextAuth URL").optional(),STRIPE_SECRET_KEY:o.Z_8().startsWith("sk_","Invalid Stripe secret key").optional(),STRIPE_PUBLISHABLE_KEY:o.Z_8().startsWith("pk_","Invalid Stripe publishable key").optional(),STRIPE_WEBHOOK_SECRET:o.Z_8().optional(),RAZORPAY_KEY_ID:o.Z_8().optional(),RAZORPAY_KEY_SECRET:o.Z_8().optional(),RAZORPAY_WEBHOOK_SECRET:o.Z_8().optional(),WEBHOOK_SECRET:o.Z_8().min(32,"Webhook secret must be at least 32 characters"),FACEBOOK_APP_ID:o.Z_8().optional(),FACEBOOK_APP_SECRET:o.Z_8().optional(),FACEBOOK_PAGE_CONFIG_ID:o.Z_8().optional(),INSTAGRAM_CONFIG_ID:o.Z_8().optional(),GOOGLE_CLIENT_ID:o.Z_8().optional(),GOOGLE_CLIENT_SECRET:o.Z_8().optional(),EVENTBRITE_CLIENT_ID:o.Z_8().optional(),EVENTBRITE_CLIENT_SECRET:o.Z_8().optional(),MEETUP_CLIENT_ID:o.Z_8().optional(),MEETUP_CLIENT_SECRET:o.Z_8().optional(),OAUTH_REDIRECT_BASE:o.Z_8().url("Invalid OAuth redirect base URL").optional(),GRAPH_API_BASE:o.Z_8().url("Invalid Graph API base URL").default("https://graph.facebook.com"),GOOGLE_BUSINESS_API_BASE:o.Z_8().url("Invalid Google Business Profile API base URL").default("https://mybusiness.googleapis.com"),ENCRYPTION_KEY:o.Z_8().length(64,"Encryption key must be 64 hex characters (32 bytes)").optional(),FEATURE_REAL_PROVIDERS:o.Z_8().transform(e=>"true"===e).default("false"),SMTP_HOST:o.Z_8().optional(),SMTP_PORT:o.Z_8().transform(Number).optional(),SMTP_USER:o.Z_8().optional(),SMTP_PASSWORD:o.Z_8().optional(),SMTP_FROM:o.Z_8().email("Invalid SMTP from email").optional(),TWILIO_ACCOUNT_SID:o.Z_8().optional(),TWILIO_AUTH_TOKEN:o.Z_8().optional(),TWILIO_PHONE_NUMBER:o.Z_8().optional(),AWS_ACCESS_KEY_ID:o.Z_8().optional(),AWS_SECRET_ACCESS_KEY:o.Z_8().optional(),AWS_REGION:o.Z_8().optional(),AWS_S3_BUCKET:o.Z_8().optional(),SENTRY_DSN:o.Z_8().url("Invalid Sentry DSN").optional(),NODE_ENV:o.KmV(["development","production","test"]).default("development"),PORT:o.Z_8().transform(Number).default("3000")}),n=(()=>{if("true"===process.env.SKIP_ENV_VALIDATION)return{DATABASE_URL:process.env.DATABASE_URL||"postgresql://dummy:dummy@localhost:5432/dummy",JWT_SECRET:process.env.JWT_SECRET||"dummy-jwt-secret-key-minimum-32-characters-long",WEBHOOK_SECRET:process.env.WEBHOOK_SECRET||"dummy-webhook-secret-key-minimum-32-characters-long",NODE_ENV:"production",PORT:process.env.PORT||"3000",FEATURE_REAL_PROVIDERS:!1,GRAPH_API_BASE:"https://graph.facebook.com",GOOGLE_BUSINESS_API_BASE:"https://mybusiness.googleapis.com"};try{return s.parse(process.env)}catch(e){if(e instanceof o.jmq&&e.errors){let t=e.errors.filter(e=>"invalid_type"===e.code&&"undefined"===e.received).map(e=>e.path.join(".")),r=e.errors.filter(e=>"invalid_type"!==e.code).map(e=>`${e.path.join(".")}: ${e.message}`),o="Environment validation failed:\n";throw t.length>0&&(o+=`
Missing required variables:
${t.map(e=>`  - ${e}`).join("\n")}`),r.length>0&&(o+=`
Invalid variables:
${r.map(e=>`  - ${e}`).join("\n")}`),Error(o)}throw e}})();n.NODE_ENV,n.NODE_ENV,n.NODE_ENV},31402:(e,t,r)=>{r.d(t,{Vm:()=>i,lI:()=>n,ok:()=>s,v6:()=>a});var o=r(87070);let s=(e,t)=>o.NextResponse.json({success:!0,data:e,...t}),n=(e,t)=>o.NextResponse.json({success:!1,error:e,errors:t},{status:400}),a=(e="Not found")=>o.NextResponse.json({success:!1,error:e},{status:404}),i=(e="Internal server error",t)=>(console.error("Server error:",t),o.NextResponse.json({success:!1,error:e,...!1},{status:500}))},71615:(e,t,r)=>{var o=r(88757);r.o(o,"cookies")&&r.d(t,{cookies:function(){return o.cookies}})},33085:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraftMode",{enumerable:!0,get:function(){return n}});let o=r(45869),s=r(6278);class n{get isEnabled(){return this._provider.isEnabled}enable(){let e=o.staticGenerationAsyncStorage.getStore();return e&&(0,s.trackDynamicDataAccessed)(e,"draftMode().enable()"),this._provider.enable()}disable(){let e=o.staticGenerationAsyncStorage.getStore();return e&&(0,s.trackDynamicDataAccessed)(e,"draftMode().disable()"),this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},88757:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{cookies:function(){return p},draftMode:function(){return f},headers:function(){return c}});let o=r(68996),s=r(53047),n=r(92044),a=r(72934),i=r(33085),l=r(6278),d=r(45869),u=r(54580);function c(){let e="headers",t=d.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return s.HeadersAdapter.seal(new Headers({}));(0,l.trackDynamicDataAccessed)(t,e)}return(0,u.getExpectedRequestStore)(e).headers}function p(){let e="cookies",t=d.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return o.RequestCookiesAdapter.seal(new n.RequestCookies(new Headers({})));(0,l.trackDynamicDataAccessed)(t,e)}let r=(0,u.getExpectedRequestStore)(e),s=a.actionAsyncStorage.getStore();return(null==s?void 0:s.isAction)||(null==s?void 0:s.isAppRoute)?r.mutableCookies:r.cookies}function f(){let e=(0,u.getExpectedRequestStore)("draftMode");return new i.DraftMode(e.draftMode)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},53047:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HeadersAdapter:function(){return n},ReadonlyHeadersError:function(){return s}});let o=r(38238);class s extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new s}}class n extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,s){if("symbol"==typeof r)return o.ReflectAdapter.get(t,r,s);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);if(void 0!==a)return o.ReflectAdapter.get(t,a,s)},set(t,r,s,n){if("symbol"==typeof r)return o.ReflectAdapter.set(t,r,s,n);let a=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===a);return o.ReflectAdapter.set(t,i??r,s,n)},has(t,r){if("symbol"==typeof r)return o.ReflectAdapter.has(t,r);let s=r.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===s);return void 0!==n&&o.ReflectAdapter.has(t,n)},deleteProperty(t,r){if("symbol"==typeof r)return o.ReflectAdapter.deleteProperty(t,r);let s=r.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===s);return void 0===n||o.ReflectAdapter.deleteProperty(t,n)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return s.callable;default:return o.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new n(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,o]of this.entries())e.call(t,o,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},68996:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{MutableRequestCookiesAdapter:function(){return c},ReadonlyRequestCookiesError:function(){return a},RequestCookiesAdapter:function(){return i},appendMutableCookies:function(){return u},getModifiedCookieValues:function(){return d}});let o=r(92044),s=r(38238),n=r(45869);class a extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new a}}class i{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return a.callable;default:return s.ReflectAdapter.get(e,t,r)}}})}}let l=Symbol.for("next.mutated.cookies");function d(e){let t=e[l];return t&&Array.isArray(t)&&0!==t.length?t:[]}function u(e,t){let r=d(t);if(0===r.length)return!1;let s=new o.ResponseCookies(e),n=s.getAll();for(let e of r)s.set(e);for(let e of n)s.set(e);return!0}class c{static wrap(e,t){let r=new o.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let a=[],i=new Set,d=()=>{let e=n.staticGenerationAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),a=r.getAll().filter(e=>i.has(e.name)),t){let e=[];for(let t of a){let r=new o.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}};return new Proxy(r,{get(e,t,r){switch(t){case l:return a;case"delete":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{d()}};case"set":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{d()}};default:return s.ReflectAdapter.get(e,t,r)}}})}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,147,5972],()=>r(63268));module.exports=o})();