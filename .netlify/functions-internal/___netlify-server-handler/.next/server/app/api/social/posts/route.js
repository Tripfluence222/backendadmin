(()=>{var e={};e.id=465,e.ids=[465],e.modules={4665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=4665,e.exports=t},53524:e=>{"use strict";e.exports=require("@prisma/client")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},85807:e=>{"use strict";e.exports=require("module")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},6005:e=>{"use strict";e.exports=require("node:crypto")},34758:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>I,patchFetch:()=>O,requestAsyncStorage:()=>m,routeModule:()=>A,serverHooks:()=>D,staticGenerationAsyncStorage:()=>S});var r={};s.r(r),s.d(r,{GET:()=>T,POST:()=>R});var a=s(49303),o=s(88716),i=s(60670),n=s(87070),l=s(88879),d=s(9487),u=s(14749),c=s(19163),E=s(29837);let p=l.Ryn({businessId:l.Z_8().cuid(),content:l.Z_8().min(1).max(2e3),platforms:l.IXX(l.KmV(["facebook","instagram","google"])).min(1),mediaUrls:l.IXX(l.Z_8().url()).optional(),scheduledAt:l.Z_8().datetime().optional()}),_=l.Ryn({businessId:l.Z_8().cuid(),status:l.KmV(["DRAFT","SCHEDULED","PUBLISHING","PUBLISHED","FAILED"]).optional(),limit:l.oQ2.number().min(1).max(100).default(20),offset:l.oQ2.number().min(0).default(0)});async function R(e){try{let t=await e.json(),s=p.safeParse(t);if(!s.success)return n.NextResponse.json({error:"Invalid request data",details:s.error.errors},{status:400});let{businessId:r,content:a,platforms:o,mediaUrls:i,scheduledAt:l}=s.data,_=await c.hS.getCurrentUser(e);if(!_)return n.NextResponse.json({error:"Unauthorized"},{status:401});if(!await c.hS.checkPermission(_.id,r,["ADMIN","MANAGER","INFLUENCER"]))return n.NextResponse.json({error:"Insufficient permissions"},{status:403});let R="true"===process.env.FEATURE_REAL_PROVIDERS,T=await d.db.socialPost.create({data:{businessId:r,content:a,platforms:o.map(e=>{switch(e){case"facebook":return"FACEBOOK_PAGE";case"instagram":return"INSTAGRAM_BUSINESS";case"google":return"GOOGLE_BUSINESS";default:return e.toUpperCase()}}),mediaUrls:i||[],scheduledAt:l?new Date(l):null,status:l?"SCHEDULED":"DRAFT"}});return!l&&R&&await (0,E.BN)({postId:T.id,platforms:o,content:a,mediaUrls:i}),await (0,u.ar)(_.id,"user","SOCIAL_POST_CREATED","SocialPost",T.id,r,{platforms:o,scheduledAt:l,useRealProviders:R}),n.NextResponse.json({success:!0,post:{id:T.id,content:T.content,platforms:T.platforms,status:T.status,scheduledAt:T.scheduledAt,createdAt:T.createdAt}})}catch(e){return console.error("Social post creation error:",e),n.NextResponse.json({error:"Failed to create social post"},{status:500})}}async function T(e){try{let{searchParams:t}=new URL(e.url),s=t.get("businessId"),r=t.get("status"),a=t.get("limit"),o=t.get("offset"),i=_.safeParse({businessId:s,status:r,limit:a,offset:o});if(!i.success)return n.NextResponse.json({error:"Invalid query parameters",details:i.error.errors},{status:400});let{businessId:l,status:u,limit:E,offset:p}=i.data,R=await c.hS.getCurrentUser(e);if(!R)return n.NextResponse.json({error:"Unauthorized"},{status:401});if(!await c.hS.checkPermission(R.id,l,["ADMIN","MANAGER","INFLUENCER","STAFF"]))return n.NextResponse.json({error:"Insufficient permissions"},{status:403});let T={businessId:l};u&&(T.status=u);let[A,m]=await Promise.all([d.db.socialPost.findMany({where:T,orderBy:{createdAt:"desc"},take:E,skip:p,select:{id:!0,content:!0,platforms:!0,status:!0,scheduledAt:!0,publishedAt:!0,externalIds:!0,errorMessage:!0,createdAt:!0,updatedAt:!0}}),d.db.socialPost.count({where:T})]);return n.NextResponse.json({success:!0,posts:A,pagination:{total:m,limit:E,offset:p,hasMore:p+E<m}})}catch(e){return console.error("Social posts fetch error:",e),n.NextResponse.json({error:"Failed to fetch social posts"},{status:500})}}let A=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/social/posts/route",pathname:"/api/social/posts",filename:"route",bundlePath:"app/api/social/posts/route"},resolvedPagePath:"/Users/kumar/Business admin/tripfluence-admin/app/api/social/posts/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:S,serverHooks:D}=A,I="/api/social/posts/route";function O(){return(0,i.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:S})}},29837:(e,t,s)=>{"use strict";s.d(t,{BN:()=>p,DJ:()=>_,FH:()=>D,Y$:()=>S,aL:()=>R});var r=s(26608),a=s(1964),o=s(57435);let i=a.OB.REDIS_URL?{host:new URL(a.OB.REDIS_URL).hostname,port:parseInt(new URL(a.OB.REDIS_URL).port),password:new URL(a.OB.REDIS_URL).password}:null,n=i?new r.ci("social",{connection:i}):null,l=i?new r.ci("event-sync",{connection:i}):null,d=i?new r.ci("webhook",{connection:i}):null,u=i?new r.ci("email",{connection:i}):null,c=i?new r.ci("sms",{connection:i}):null,E=i?new r.ci("space",{connection:i}):null,p=async(e,t)=>n?n.add("publish",e,{delay:e.scheduledAt?new Date(e.scheduledAt).getTime()-Date.now():0,attempts:3,backoff:{type:"exponential",delay:2e3},...t}):(o.k.warn("Redis not configured, skipping social publish job"),null),_=async(e,t)=>l?l.add("sync",e,{attempts:3,backoff:{type:"exponential",delay:5e3},...t}):(o.k.warn("Redis not configured, skipping event sync job"),null),R=async(e,t)=>d?d.add("dispatch",e,{attempts:5,backoff:{type:"exponential",delay:1e3},...t}):(o.k.warn("Redis not configured, skipping webhook job"),null),T=async(e,t)=>u?u.add("send",e,{attempts:3,backoff:{type:"exponential",delay:2e3},...t}):(o.k.warn("Redis not configured, skipping email job"),null),A=async(e,t)=>c?c.add("send",e,{attempts:3,backoff:{type:"exponential",delay:2e3},...t}):(o.k.warn("Redis not configured, skipping SMS job"),null),m=async(e,t)=>E?E.add("hold-expire",e,{attempts:1,...t}):(o.k.warn("Redis not configured, skipping space hold expire job"),null),S=async(e,t,s)=>{switch(e){case"socialPublish":return p(t,s);case"eventSync":return _(t,s);case"webhook":return R(t,s);case"email":return T(t,s);case"sms":return A(t,s);case"spaceHoldExpire":return m(t,s);default:throw Error(`Unknown queue: ${e}`)}},D=async()=>{if(!a.OB.REDIS_URL)return{social:{waiting:0,active:0,completed:0,failed:0,delayed:0},eventSync:{waiting:0,active:0,completed:0,failed:0,delayed:0},webhook:{waiting:0,active:0,completed:0,failed:0,delayed:0},email:{waiting:0,active:0,completed:0,failed:0,delayed:0},sms:{waiting:0,active:0,completed:0,failed:0,delayed:0},space:{waiting:0,active:0,completed:0,failed:0,delayed:0}};let[e,t,s,r,o,i]=await Promise.all([n.getJobCounts(),l.getJobCounts(),d.getJobCounts(),u.getJobCounts(),c.getJobCounts(),E.getJobCounts()]);return{social:e,eventSync:t,webhook:s,email:r,sms:o,space:i}}},14749:(e,t,s)=>{"use strict";s.d(t,{ar:()=>n,sZ:()=>i});var r=s(9487),a=s(57435),o=s(60581);let i={LISTING_CREATED:"listing.created",LISTING_UPDATED:"listing.updated",LISTING_DELETED:"listing.deleted",LISTING_PUBLISHED:"listing.published",LISTING_UNPUBLISHED:"listing.unpublished",ORDER_CREATED:"order.created",ORDER_UPDATED:"order.updated",ORDER_CANCELLED:"order.cancelled",ORDER_REFUNDED:"order.refunded",SLOT_CREATED:"slot.created",SLOT_UPDATED:"slot.updated",SLOT_DELETED:"slot.deleted",SLOTS_IMPORTED:"slots.imported",SLOTS_EXPORTED:"slots.exported",WIDGET_CREATED:"widget.created",WIDGET_UPDATED:"widget.updated",WIDGET_DELETED:"widget.deleted",WIDGET_GENERATED:"widget.generated",SOCIAL_POST_CREATED:"social.post.created",SOCIAL_POST_PUBLISHED:"social.post.published",SOCIAL_POST_FAILED:"social.post.failed",SOCIAL_TEST_POST:"social.test.post",SOCIAL_ACCOUNT_CONNECTED:"social.account.connected",SOCIAL_ACCOUNT_DISCONNECTED:"social.account.disconnected",PROVIDER_CONNECTED:"provider.connected",PROVIDER_DISCONNECTED:"provider.disconnected",PROVIDER_RECONNECT_REQUESTED:"provider.reconnect.requested",PROVIDER_REFRESHED:"provider.refreshed",EVENT_SYNC_CREATED:"event.sync.created",EVENT_SYNC_UPDATED:"event.sync.updated",EVENT_SYNC_DELETED:"event.sync.deleted",EVENT_SYNC_PUBLISHED:"event.sync.published",EVENT_SYNC_IMPORTED:"event.sync.imported",EVENT_PUBLISHED:"event.published",EVENT_UPDATED:"event.updated",EVENT_FAILED:"event.failed",EVENT_TEST_PUBLISH:"event.test.publish",COUPON_CREATED:"coupon.created",COUPON_UPDATED:"coupon.updated",COUPON_DELETED:"coupon.deleted",AFFILIATE_CREATED:"affiliate.created",AFFILIATE_UPDATED:"affiliate.updated",AFFILIATE_DELETED:"affiliate.deleted",SETTINGS_UPDATED:"settings.updated",USER_CREATED:"user.created",USER_UPDATED:"user.updated",USER_DELETED:"user.deleted",WEBHOOK_CREATED:"webhook.created",WEBHOOK_UPDATED:"webhook.updated",WEBHOOK_DELETED:"webhook.deleted",API_KEY_CREATED:"api.key.created",API_KEY_DELETED:"api.key.deleted",LOGIN:"user.login",LOGOUT:"user.logout",PASSWORD_CHANGED:"user.password.changed",PERMISSION_CHANGED:"user.permission.changed"},n=async(e,t,s,i,n,l,d={},u)=>{try{let c=await r.db.auditLog.create({data:{id:(0,o.x0)(),actorId:e,actorType:t,action:s,entityType:i,entityId:n,businessId:l,metadata:JSON.stringify(d),ipAddress:u?.ipAddress,userAgent:u?.userAgent}});return a.k.info(`Audit log created: ${s} on ${i}:${n} by ${t}:${e}`),c}catch(e){throw a.k.error("Failed to create audit log entry:",e),e}}},9487:(e,t,s)=>{"use strict";s.d(t,{db:()=>n});var r=s(53524),a=s(1964);let o=globalThis,i=()=>({$queryRaw:()=>Promise.resolve([]),$executeRaw:()=>Promise.resolve(0),$transaction:e=>e({}),user:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},business:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},space:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},socialAccount:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},webhookDelivery:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},auditLog:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceAvailability:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceRequest:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)}}),n=(()=>{process.env.SKIP_ENV_VALIDATION;try{return o.prisma??new r.PrismaClient({log:"development"===a.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:a.OB.DATABASE_URL}}})}catch(e){return console.warn("Database connection failed during build, using mock database:",e),i()}return o.prisma??new r.PrismaClient({log:"development"===a.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:a.OB.DATABASE_URL}}})})();"production"!==a.OB.NODE_ENV&&(o.prisma=n)},1964:(e,t,s)=>{"use strict";s.d(t,{OB:()=>o});var r=s(88879);let a=r.Ryn({DATABASE_URL:r.Z_8().url("Invalid database URL"),REDIS_URL:r.Z_8().url("Invalid Redis URL").optional(),JWT_SECRET:r.Z_8().min(32,"JWT secret must be at least 32 characters"),NEXTAUTH_SECRET:r.Z_8().min(32,"NextAuth secret must be at least 32 characters").optional(),NEXTAUTH_URL:r.Z_8().url("Invalid NextAuth URL").optional(),STRIPE_SECRET_KEY:r.Z_8().startsWith("sk_","Invalid Stripe secret key").optional(),STRIPE_PUBLISHABLE_KEY:r.Z_8().startsWith("pk_","Invalid Stripe publishable key").optional(),STRIPE_WEBHOOK_SECRET:r.Z_8().optional(),RAZORPAY_KEY_ID:r.Z_8().optional(),RAZORPAY_KEY_SECRET:r.Z_8().optional(),RAZORPAY_WEBHOOK_SECRET:r.Z_8().optional(),WEBHOOK_SECRET:r.Z_8().min(32,"Webhook secret must be at least 32 characters"),FACEBOOK_APP_ID:r.Z_8().optional(),FACEBOOK_APP_SECRET:r.Z_8().optional(),FACEBOOK_PAGE_CONFIG_ID:r.Z_8().optional(),INSTAGRAM_CONFIG_ID:r.Z_8().optional(),GOOGLE_CLIENT_ID:r.Z_8().optional(),GOOGLE_CLIENT_SECRET:r.Z_8().optional(),EVENTBRITE_CLIENT_ID:r.Z_8().optional(),EVENTBRITE_CLIENT_SECRET:r.Z_8().optional(),MEETUP_CLIENT_ID:r.Z_8().optional(),MEETUP_CLIENT_SECRET:r.Z_8().optional(),OAUTH_REDIRECT_BASE:r.Z_8().url("Invalid OAuth redirect base URL").optional(),GRAPH_API_BASE:r.Z_8().url("Invalid Graph API base URL").default("https://graph.facebook.com"),GOOGLE_BUSINESS_API_BASE:r.Z_8().url("Invalid Google Business Profile API base URL").default("https://mybusiness.googleapis.com"),ENCRYPTION_KEY:r.Z_8().length(64,"Encryption key must be 64 hex characters (32 bytes)").optional(),FEATURE_REAL_PROVIDERS:r.Z_8().transform(e=>"true"===e).default("false"),SMTP_HOST:r.Z_8().optional(),SMTP_PORT:r.Z_8().transform(Number).optional(),SMTP_USER:r.Z_8().optional(),SMTP_PASSWORD:r.Z_8().optional(),SMTP_FROM:r.Z_8().email("Invalid SMTP from email").optional(),TWILIO_ACCOUNT_SID:r.Z_8().optional(),TWILIO_AUTH_TOKEN:r.Z_8().optional(),TWILIO_PHONE_NUMBER:r.Z_8().optional(),AWS_ACCESS_KEY_ID:r.Z_8().optional(),AWS_SECRET_ACCESS_KEY:r.Z_8().optional(),AWS_REGION:r.Z_8().optional(),AWS_S3_BUCKET:r.Z_8().optional(),SENTRY_DSN:r.Z_8().url("Invalid Sentry DSN").optional(),NODE_ENV:r.KmV(["development","production","test"]).default("development"),PORT:r.Z_8().transform(Number).default("3000")}),o=(()=>{if("true"===process.env.SKIP_ENV_VALIDATION)return{DATABASE_URL:process.env.DATABASE_URL||"postgresql://dummy:dummy@localhost:5432/dummy",JWT_SECRET:process.env.JWT_SECRET||"dummy-jwt-secret-key-minimum-32-characters-long",WEBHOOK_SECRET:process.env.WEBHOOK_SECRET||"dummy-webhook-secret-key-minimum-32-characters-long",NODE_ENV:"production",PORT:process.env.PORT||"3000",FEATURE_REAL_PROVIDERS:!1,GRAPH_API_BASE:"https://graph.facebook.com",GOOGLE_BUSINESS_API_BASE:"https://mybusiness.googleapis.com"};try{return a.parse(process.env)}catch(e){if(e instanceof r.jmq&&e.errors){let t=e.errors.filter(e=>"invalid_type"===e.code&&"undefined"===e.received).map(e=>e.path.join(".")),s=e.errors.filter(e=>"invalid_type"!==e.code).map(e=>`${e.path.join(".")}: ${e.message}`),r="Environment validation failed:\n";throw t.length>0&&(r+=`
Missing required variables:
${t.map(e=>`  - ${e}`).join("\n")}`),s.length>0&&(r+=`
Invalid variables:
${s.map(e=>`  - ${e}`).join("\n")}`),Error(r)}throw e}})();o.NODE_ENV,o.NODE_ENV,o.NODE_ENV},60581:(e,t,s)=>{"use strict";s.d(t,{x0:()=>r.x0});var r=s(42549);(0,r.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",8),(0,r.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",10),(0,r.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",8)},57435:(e,t,s)=>{"use strict";s.d(t,{k:()=>r});let r={info:(e,...t)=>{console.log(`[INFO] ${e}`,...t)},warn:(e,...t)=>{console.warn(`[WARN] ${e}`,...t)},error:(e,...t)=>{console.error(`[ERROR] ${e}`,...t)},debug:(e,...t)=>{}}},19163:(e,t,s)=>{"use strict";s.d(t,{hS:()=>l,rt:()=>o});var r=s(9487),a=s(53524);async function o(e,t,s){try{return!!await r.db.roleAssignment.findFirst({where:{userId:e,businessId:t,role:{in:s}}})}catch(e){return console.error("Error checking RBAC:",e),!1}}async function i(e,t){try{let s=await r.db.roleAssignment.findFirst({where:{userId:e,businessId:t}});return s?.role||null}catch(e){return console.error("Error getting user role:",e),null}}async function n(e,t,s){try{let r=await i(e,t);if(!r)return!1;let o={[a.Role.ADMIN]:["spaces.create","spaces.read","spaces.update","spaces.delete","spaces.publish","requests.read","requests.approve","requests.decline","requests.cancel","pricing.manage","availability.manage","payouts.manage","users.manage","settings.manage"],[a.Role.MANAGER]:["spaces.create","spaces.read","spaces.update","spaces.publish","requests.read","requests.approve","requests.decline","requests.cancel","pricing.manage","availability.manage","payouts.view"],[a.Role.STAFF]:["spaces.read","requests.read","requests.cancel","availability.read"],[a.Role.INFLUENCER]:["spaces.read"]};return o[r]?.includes(s)||!1}catch(e){return console.error("Error checking permission:",e),!1}}let l={checkRBAC:o,getUserRole:i,hasPermission:n}},42549:(e,t,s)=>{"use strict";let r,a;s.d(t,{kP:()=>n,x0:()=>l});var o=s(6005);function i(e){!r||r.length<e?(r=Buffer.allocUnsafe(128*e),o.webcrypto.getRandomValues(r),a=0):a+e>r.length&&(o.webcrypto.getRandomValues(r),a=0),a+=e}function n(e,t=21){var s;let o,n;return s=t,n=Math.ceil(1.6*(o=(2<<31-Math.clz32(e.length-1|1))-1)*s/e.length),(t=s)=>{if(!t)return"";let l="";for(;;){var d;let s=(i(d=0|n),r.subarray(a-d,a)),u=n;for(;u--;)if((l+=e[s[u]&o]||"").length>=t)return l}}}function l(e=21){i(e|=0);let t="";for(let s=a-e;s<a;s++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[s]];return t}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,147,5972,6608],()=>s(34758));module.exports=r})();