exports.id=5344,exports.ids=[5344],exports.modules={4665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=4665,e.exports=t},29837:(e,t,o)=>{"use strict";o.d(t,{BN:()=>p,DJ:()=>u,FH:()=>S,Y$:()=>I,aL:()=>R});var n=o(26608),i=o(1964),a=o(57435);let r=i.OB.REDIS_URL?{host:new URL(i.OB.REDIS_URL).hostname,port:parseInt(new URL(i.OB.REDIS_URL).port),password:new URL(i.OB.REDIS_URL).password}:null,s=r?new n.ci("social",{connection:r}):null,l=r?new n.ci("event-sync",{connection:r}):null,E=r?new n.ci("webhook",{connection:r}):null,d=r?new n.ci("email",{connection:r}):null,_=r?new n.ci("sms",{connection:r}):null,c=r?new n.ci("space",{connection:r}):null,p=async(e,t)=>s?s.add("publish",e,{delay:e.scheduledAt?new Date(e.scheduledAt).getTime()-Date.now():0,attempts:3,backoff:{type:"exponential",delay:2e3},...t}):(a.k.warn("Redis not configured, skipping social publish job"),null),u=async(e,t)=>l?l.add("sync",e,{attempts:3,backoff:{type:"exponential",delay:5e3},...t}):(a.k.warn("Redis not configured, skipping event sync job"),null),R=async(e,t)=>E?E.add("dispatch",e,{attempts:5,backoff:{type:"exponential",delay:1e3},...t}):(a.k.warn("Redis not configured, skipping webhook job"),null),T=async(e,t)=>d?d.add("send",e,{attempts:3,backoff:{type:"exponential",delay:2e3},...t}):(a.k.warn("Redis not configured, skipping email job"),null),D=async(e,t)=>_?_.add("send",e,{attempts:3,backoff:{type:"exponential",delay:2e3},...t}):(a.k.warn("Redis not configured, skipping SMS job"),null),A=async(e,t)=>c?c.add("hold-expire",e,{attempts:1,...t}):(a.k.warn("Redis not configured, skipping space hold expire job"),null),I=async(e,t,o)=>{switch(e){case"socialPublish":return p(t,o);case"eventSync":return u(t,o);case"webhook":return R(t,o);case"email":return T(t,o);case"sms":return D(t,o);case"spaceHoldExpire":return A(t,o);default:throw Error(`Unknown queue: ${e}`)}},S=async()=>{if(!i.OB.REDIS_URL)return{social:{waiting:0,active:0,completed:0,failed:0,delayed:0},eventSync:{waiting:0,active:0,completed:0,failed:0,delayed:0},webhook:{waiting:0,active:0,completed:0,failed:0,delayed:0},email:{waiting:0,active:0,completed:0,failed:0,delayed:0},sms:{waiting:0,active:0,completed:0,failed:0,delayed:0},space:{waiting:0,active:0,completed:0,failed:0,delayed:0}};let[e,t,o,n,a,r]=await Promise.all([s.getJobCounts(),l.getJobCounts(),E.getJobCounts(),d.getJobCounts(),_.getJobCounts(),c.getJobCounts()]);return{social:e,eventSync:t,webhook:o,email:n,sms:a,space:r}}},14749:(e,t,o)=>{"use strict";o.d(t,{ar:()=>s,sZ:()=>r});var n=o(9487),i=o(57435),a=o(60581);let r={LISTING_CREATED:"listing.created",LISTING_UPDATED:"listing.updated",LISTING_DELETED:"listing.deleted",LISTING_PUBLISHED:"listing.published",LISTING_UNPUBLISHED:"listing.unpublished",ORDER_CREATED:"order.created",ORDER_UPDATED:"order.updated",ORDER_CANCELLED:"order.cancelled",ORDER_REFUNDED:"order.refunded",SLOT_CREATED:"slot.created",SLOT_UPDATED:"slot.updated",SLOT_DELETED:"slot.deleted",SLOTS_IMPORTED:"slots.imported",SLOTS_EXPORTED:"slots.exported",WIDGET_CREATED:"widget.created",WIDGET_UPDATED:"widget.updated",WIDGET_DELETED:"widget.deleted",WIDGET_GENERATED:"widget.generated",SOCIAL_POST_CREATED:"social.post.created",SOCIAL_POST_PUBLISHED:"social.post.published",SOCIAL_POST_FAILED:"social.post.failed",SOCIAL_TEST_POST:"social.test.post",SOCIAL_ACCOUNT_CONNECTED:"social.account.connected",SOCIAL_ACCOUNT_DISCONNECTED:"social.account.disconnected",PROVIDER_CONNECTED:"provider.connected",PROVIDER_DISCONNECTED:"provider.disconnected",PROVIDER_RECONNECT_REQUESTED:"provider.reconnect.requested",PROVIDER_REFRESHED:"provider.refreshed",EVENT_SYNC_CREATED:"event.sync.created",EVENT_SYNC_UPDATED:"event.sync.updated",EVENT_SYNC_DELETED:"event.sync.deleted",EVENT_SYNC_PUBLISHED:"event.sync.published",EVENT_SYNC_IMPORTED:"event.sync.imported",EVENT_PUBLISHED:"event.published",EVENT_UPDATED:"event.updated",EVENT_FAILED:"event.failed",EVENT_TEST_PUBLISH:"event.test.publish",COUPON_CREATED:"coupon.created",COUPON_UPDATED:"coupon.updated",COUPON_DELETED:"coupon.deleted",AFFILIATE_CREATED:"affiliate.created",AFFILIATE_UPDATED:"affiliate.updated",AFFILIATE_DELETED:"affiliate.deleted",SETTINGS_UPDATED:"settings.updated",USER_CREATED:"user.created",USER_UPDATED:"user.updated",USER_DELETED:"user.deleted",WEBHOOK_CREATED:"webhook.created",WEBHOOK_UPDATED:"webhook.updated",WEBHOOK_DELETED:"webhook.deleted",API_KEY_CREATED:"api.key.created",API_KEY_DELETED:"api.key.deleted",LOGIN:"user.login",LOGOUT:"user.logout",PASSWORD_CHANGED:"user.password.changed",PERMISSION_CHANGED:"user.permission.changed"},s=async(e,t,o,r,s,l,E={},d)=>{try{let _=await n.db.auditLog.create({data:{id:(0,a.x0)(),actorId:e,actorType:t,action:o,entityType:r,entityId:s,businessId:l,metadata:JSON.stringify(E),ipAddress:d?.ipAddress,userAgent:d?.userAgent}});return i.k.info(`Audit log created: ${o} on ${r}:${s} by ${t}:${e}`),_}catch(e){throw i.k.error("Failed to create audit log entry:",e),e}}},90455:(e,t,o)=>{"use strict";o.d(t,{Ql:()=>s,mk:()=>r,ts:()=>a});var n=o(71615),i=o(9487);async function a(){try{let e=(0,n.cookies)(),t=e.get("user-id")?.value;if(!t)return null;let o=await i.db.user.findUnique({where:{id:t},select:{id:!0,email:!0,firstName:!0,lastName:!0,businessId:!0,isActive:!0,lastLoginAt:!0}});if(!o||!o.isActive)return null;return o}catch(e){return console.error("Error getting current user:",e),null}}async function r(){let e=await a();if(!e)throw Error("Authentication required");return e}async function s(e){return await r()}},9487:(e,t,o)=>{"use strict";o.d(t,{db:()=>s});var n=o(53524),i=o(1964);let a=globalThis,r=()=>({$queryRaw:()=>Promise.resolve([]),$executeRaw:()=>Promise.resolve(0),$transaction:e=>e({}),user:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},business:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},space:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},socialAccount:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},webhookDelivery:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},auditLog:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceAvailability:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)},spaceRequest:{findMany:()=>Promise.resolve([]),findFirst:()=>Promise.resolve(null)}}),s=(()=>{process.env.SKIP_ENV_VALIDATION;try{return a.prisma??new n.PrismaClient({log:"development"===i.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:i.OB.DATABASE_URL}}})}catch(e){return console.warn("Database connection failed during build, using mock database:",e),r()}return a.prisma??new n.PrismaClient({log:"development"===i.OB.NODE_ENV?["query","error","warn"]:["error"],datasources:{db:{url:i.OB.DATABASE_URL}}})})();"production"!==i.OB.NODE_ENV&&(a.prisma=s)},1964:(e,t,o)=>{"use strict";o.d(t,{OB:()=>a});var n=o(88879);let i=n.Ryn({DATABASE_URL:n.Z_8().url("Invalid database URL"),REDIS_URL:n.Z_8().url("Invalid Redis URL").optional(),JWT_SECRET:n.Z_8().min(32,"JWT secret must be at least 32 characters"),NEXTAUTH_SECRET:n.Z_8().min(32,"NextAuth secret must be at least 32 characters").optional(),NEXTAUTH_URL:n.Z_8().url("Invalid NextAuth URL").optional(),STRIPE_SECRET_KEY:n.Z_8().startsWith("sk_","Invalid Stripe secret key").optional(),STRIPE_PUBLISHABLE_KEY:n.Z_8().startsWith("pk_","Invalid Stripe publishable key").optional(),STRIPE_WEBHOOK_SECRET:n.Z_8().optional(),RAZORPAY_KEY_ID:n.Z_8().optional(),RAZORPAY_KEY_SECRET:n.Z_8().optional(),RAZORPAY_WEBHOOK_SECRET:n.Z_8().optional(),WEBHOOK_SECRET:n.Z_8().min(32,"Webhook secret must be at least 32 characters"),FACEBOOK_APP_ID:n.Z_8().optional(),FACEBOOK_APP_SECRET:n.Z_8().optional(),FACEBOOK_PAGE_CONFIG_ID:n.Z_8().optional(),INSTAGRAM_CONFIG_ID:n.Z_8().optional(),GOOGLE_CLIENT_ID:n.Z_8().optional(),GOOGLE_CLIENT_SECRET:n.Z_8().optional(),EVENTBRITE_CLIENT_ID:n.Z_8().optional(),EVENTBRITE_CLIENT_SECRET:n.Z_8().optional(),MEETUP_CLIENT_ID:n.Z_8().optional(),MEETUP_CLIENT_SECRET:n.Z_8().optional(),OAUTH_REDIRECT_BASE:n.Z_8().url("Invalid OAuth redirect base URL").optional(),GRAPH_API_BASE:n.Z_8().url("Invalid Graph API base URL").default("https://graph.facebook.com"),GOOGLE_BUSINESS_API_BASE:n.Z_8().url("Invalid Google Business Profile API base URL").default("https://mybusiness.googleapis.com"),ENCRYPTION_KEY:n.Z_8().length(64,"Encryption key must be 64 hex characters (32 bytes)").optional(),FEATURE_REAL_PROVIDERS:n.Z_8().transform(e=>"true"===e).default("false"),SMTP_HOST:n.Z_8().optional(),SMTP_PORT:n.Z_8().transform(Number).optional(),SMTP_USER:n.Z_8().optional(),SMTP_PASSWORD:n.Z_8().optional(),SMTP_FROM:n.Z_8().email("Invalid SMTP from email").optional(),TWILIO_ACCOUNT_SID:n.Z_8().optional(),TWILIO_AUTH_TOKEN:n.Z_8().optional(),TWILIO_PHONE_NUMBER:n.Z_8().optional(),AWS_ACCESS_KEY_ID:n.Z_8().optional(),AWS_SECRET_ACCESS_KEY:n.Z_8().optional(),AWS_REGION:n.Z_8().optional(),AWS_S3_BUCKET:n.Z_8().optional(),SENTRY_DSN:n.Z_8().url("Invalid Sentry DSN").optional(),NODE_ENV:n.KmV(["development","production","test"]).default("development"),PORT:n.Z_8().transform(Number).default("3000")}),a=(()=>{if("true"===process.env.SKIP_ENV_VALIDATION)return{DATABASE_URL:process.env.DATABASE_URL||"postgresql://dummy:dummy@localhost:5432/dummy",JWT_SECRET:process.env.JWT_SECRET||"dummy-jwt-secret-key-minimum-32-characters-long",WEBHOOK_SECRET:process.env.WEBHOOK_SECRET||"dummy-webhook-secret-key-minimum-32-characters-long",NODE_ENV:"production",PORT:process.env.PORT||"3000",FEATURE_REAL_PROVIDERS:!1,GRAPH_API_BASE:"https://graph.facebook.com",GOOGLE_BUSINESS_API_BASE:"https://mybusiness.googleapis.com"};try{return i.parse(process.env)}catch(e){if(e instanceof n.jmq&&e.errors){let t=e.errors.filter(e=>"invalid_type"===e.code&&"undefined"===e.received).map(e=>e.path.join(".")),o=e.errors.filter(e=>"invalid_type"!==e.code).map(e=>`${e.path.join(".")}: ${e.message}`),n="Environment validation failed:\n";throw t.length>0&&(n+=`
Missing required variables:
${t.map(e=>`  - ${e}`).join("\n")}`),o.length>0&&(n+=`
Invalid variables:
${o.map(e=>`  - ${e}`).join("\n")}`),Error(n)}throw e}})();a.NODE_ENV,a.NODE_ENV,a.NODE_ENV},31402:(e,t,o)=>{"use strict";o.d(t,{Vm:()=>s,lI:()=>a,ok:()=>i,v6:()=>r});var n=o(87070);let i=(e,t)=>n.NextResponse.json({success:!0,data:e,...t}),a=(e,t)=>n.NextResponse.json({success:!1,error:e,errors:t},{status:400}),r=(e="Not found")=>n.NextResponse.json({success:!1,error:e},{status:404}),s=(e="Internal server error",t)=>(console.error("Server error:",t),n.NextResponse.json({success:!1,error:e,...!1},{status:500}))},60581:(e,t,o)=>{"use strict";o.d(t,{x0:()=>n.x0});var n=o(42549);(0,n.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",8),(0,n.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",10),(0,n.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",8)},57435:(e,t,o)=>{"use strict";o.d(t,{k:()=>n});let n={info:(e,...t)=>{console.log(`[INFO] ${e}`,...t)},warn:(e,...t)=>{console.warn(`[WARN] ${e}`,...t)},error:(e,...t)=>{console.error(`[ERROR] ${e}`,...t)},debug:(e,...t)=>{}}},63261:(e,t,o)=>{"use strict";o.d(t,{gl:()=>p,z9:()=>u});var n=o(88879);let i=n.Z_8().url().refine(e=>/\.(jpg|jpeg|png|webp|avif)(\?.*)?$/i.test(e),"Unsupported image type"),a={title:n.Z_8().min(3),description:n.Z_8().max(5e3).optional(),category:n.Z_8().optional(),locationCity:n.Z_8().max(120).optional(),locationCountry:n.Z_8().max(120).optional(),slug:n.Z_8().regex(/^[a-z0-9-]+$/),status:n.KmV(["DRAFT","PUBLISHED","ARCHIVED"]).default("DRAFT"),photos:n.IXX(i).max(10).default([]),currency:n.Z_8().length(3).optional(),priceFrom:n.Rxh().int().nonnegative().optional(),capacity:n.Rxh().int().positive().optional(),seoMeta:n.Z_8().max(160).optional()},r=n.Ryn({kind:n.i0J("RESTAURANT"),menuUrl:n.Z_8().url().optional(),hours:n.IXX(n.Ryn({day:n.Z_8(),open:n.Z_8(),close:n.Z_8()})).optional(),reservationUrl:n.Z_8().url().optional(),cuisines:n.IXX(n.Z_8()).optional()}),s=n.Ryn({kind:n.i0J("RETREAT"),startDate:n.Z_8().datetime(),endDate:n.Z_8().datetime(),packagePrice:n.Rxh().int().nonnegative(),includes:n.IXX(n.Z_8()).optional(),accommodations:n.IXX(n.Ryn({name:n.Z_8(),beds:n.Rxh().int().positive(),price:n.Rxh().int().nonnegative()})).optional(),location:n.Ryn({address:n.Z_8().optional(),lat:n.Rxh().optional(),lng:n.Rxh().optional()}).optional()}),l=n.Ryn({name:n.Z_8(),price:n.Rxh().int().nonnegative(),qty:n.Rxh().int().positive()}),E=n.Ryn({kind:n.i0J("EVENT"),start:n.Z_8().datetime(),end:n.Z_8().datetime(),venue:n.Ryn({name:n.Z_8().optional(),address:n.Z_8().optional(),lat:n.Rxh().optional(),lng:n.Rxh().optional()}),tickets:n.IXX(l).min(1),rsvpUrl:n.Z_8().url().optional(),externalLinks:n.IXX(n.Z_8().url()).optional()}),d=n.Ryn({kind:n.i0J("ACTIVITY"),schedule:n.IXX(n.Ryn({date:n.Z_8().datetime(),durationMin:n.Rxh().int().positive()})).min(1),skillLevel:n.KmV(["BEGINNER","INTERMEDIATE","ADVANCED"]).optional(),equipmentProvided:n.O72().optional(),pricePerPerson:n.Rxh().int().nonnegative(),meetPoint:n.Z_8().optional()}),_=n.Ryn({kind:n.i0J("PROPERTY"),rentalType:n.KmV(["HOURLY","DAILY","NIGHTLY"]),rate:n.Rxh().int().nonnegative(),cleaningFee:n.Rxh().int().nonnegative().optional(),securityDeposit:n.Rxh().int().nonnegative().optional(),bedrooms:n.Rxh().int().nonnegative().optional(),baths:n.Rxh().int().nonnegative().optional(),amenities:n.IXX(n.Z_8()).optional(),rules:n.IXX(n.Z_8()).optional(),address:n.Z_8().optional(),lat:n.Rxh().optional(),lng:n.Rxh().optional()}),c=n.VKR("kind",[r,s,E,d,_]),p=n.Ryn({type:n.KmV(["RESTAURANT","RETREAT","EVENT","ACTIVITY","PROPERTY"]),...a,details:c}),u=p.extend({id:n.Z_8()}).partial({title:!0,description:!0,category:!0,locationCity:!0,locationCountry:!0,slug:!0,status:!0,photos:!0,currency:!0,priceFrom:!0,capacity:!0,seoMeta:!0,details:!0,type:!0});n.KmV(["RESTAURANT","RETREAT","EVENT","ACTIVITY","PROPERTY"]),n.KmV(["DRAFT","PUBLISHED","ARCHIVED"])},66907:(e,t,o)=>{"use strict";o.d(t,{DR:()=>l,yd:()=>r});var n=o(9487),i=o(57435),a=o(29837);o(60581);let r={LISTING_CREATED:"listing.created",LISTING_UPDATED:"listing.updated",LISTING_DELETED:"listing.deleted",LISTING_PUBLISHED:"listing.published",ORDER_CREATED:"order.created",ORDER_UPDATED:"order.updated",ORDER_CANCELLED:"order.cancelled",ORDER_REFUNDED:"order.refunded",SLOT_CREATED:"slot.created",SLOT_UPDATED:"slot.updated",SLOT_DELETED:"slot.deleted",SOCIAL_POST_PUBLISHED:"social.post.published",SOCIAL_POST_FAILED:"social.post.failed",EVENT_SYNC_PUBLISHED:"event.sync.published",EVENT_SYNC_IMPORTED:"event.sync.imported",COUPON_CREATED:"coupon.created",COUPON_UPDATED:"coupon.updated",COUPON_DELETED:"coupon.deleted"},s=async(e,t={})=>{try{let o={businessId:e};return t.event&&(o.events={has:t.event}),void 0!==t.isActive&&(o.isActive=t.isActive),await n.db.webhookEndpoint.findMany({where:o,orderBy:{createdAt:"desc"}})}catch(e){throw i.k.error("Failed to get webhook endpoints:",e),e}},l=async(e,t,o,n={})=>{try{let r=await s(o,{event:e,isActive:!0});if(0===r.length){i.k.info(`No webhooks configured for event: ${e}`);return}let l=r.map(o=>(0,a.aL)({webhookId:o.id,event:e,data:t,retryCount:n.retryCount||0},{delay:n.delay||0}));await Promise.all(l),i.k.info(`Triggered ${r.length} webhooks for event: ${e}`)}catch(t){throw i.k.error(`Failed to trigger webhook for event ${e}:`,t),t}}}};